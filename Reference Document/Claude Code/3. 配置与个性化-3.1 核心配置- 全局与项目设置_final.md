---
title: "Claude Code 全局与项目设置完全指南：配置系统的深度解析"
description: "深入了解 Claude Code 的配置系统，包括作用域优先级、设置文件结构、权限管理、环境变量和沙箱配置等核心功能。"
date: "2026-02-10"
tool: "Claude Code"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code 全局与项目设置完全指南：配置系统的深度解析

Claude Code 提供了一个灵活而强大的配置系统，支持从个人偏好到企业级部署的多种场景。掌握这个配置系统将帮助您根据不同需求定制 Claude Code，使其完美适配您的工作流程。

<AdPlaceholder />

## 前置条件

在学习配置系统之前，请确保您具备以下条件：

- **Claude Code**：已安装并可运行的 Claude Code
- **JSON 基础**：了解基本的 JSON 语法
- **编辑器**：支持 JSON 语法高亮的代码编辑器
- **项目经验**：有使用版本控制系统的经验

## 步骤 1：理解配置作用域系统

### 步骤 1.1：四种作用域类型

Claude Code 使用**作用域系统**来确定配置应用的位置以及与谁共享。了解作用域是正确配置的基础。

| 作用域 | 位置 | 影响范围 | 与团队共享？ |
|--------|------|----------|--------------|
| **Managed** | 系统级 `managed-settings.json` | 机器上的所有用户 | 是（由 IT 部署） |
| **User** | `~/.claude/` 目录 | 您，跨所有项目 | 否 |
| **Project** | 存储库中的 `.claude/` | 此存储库上的所有协作者 | 是（提交到 git） |
| **Local** | `.claude/*.local.*` 文件 | 您，仅在此存储库中 | 否（gitignored） |

<ProTip>
选择正确的作用域可以确保配置既满足需求又不影响他人。
</ProTip>

### 步骤 1.2：选择正确的作用域

**Managed 作用域适用于：**

- 必须在整个组织范围内强制执行的安全策略
- 无法被覆盖的合规要求
- 由 IT/DevOps 部署的标准化配置

**User 作用域适用于：**

- 您想在任何地方使用的个人偏好（主题、编辑器设置）
- 您在所有项目中使用的工具和插件
- API 密钥和身份验证（安全存储）

**Project 作用域适用于：**

- 团队共享的设置（权限、hooks、MCP servers）
- 整个团队应该拥有的插件
- 跨协作者标准化工具

**Local 作用域适用于：**

- 特定项目的个人覆盖
- 在与团队共享之前测试配置
- 对其他人不适用的特定于机器的设置

### 步骤 1.3：作用域优先级

当在多个作用域中配置相同的设置时，更具体的作用域优先：

1. **Managed**（最高）- 无法被任何内容覆盖
2. **命令行参数** - 临时会话覆盖
3. **Local** - 覆盖项目和用户设置
4. **Project** - 覆盖用户设置
5. **User**（最低）- 当没有其他内容指定设置时应用

<Note>
例如，如果在用户设置中允许某个权限，但在项目设置中拒绝，则项目设置优先，权限被阻止。
</Note>

## 步骤 2：设置文件结构

### 步骤 2.1：理解设置文件

`settings.json` 文件是配置 Claude Code 的官方机制：

**用户设置：**
```json
~/.claude/settings.json
```

**项目设置：**
```json
.claude/settings.json  // 用于团队共享
.claude/settings.local.json  // 用于个人偏好
```

**Managed 设置：**
```json
// macOS
/Library/Application Support/ClaudeCode/

// Linux 和 WSL
/etc/claude-code/

// Windows
C:\Program Files\ClaudeCode\
```

<Note>
这些是系统范围的路径，需要管理员权限，设计用于由 IT 管理员部署。
</Note>

### 步骤 2.2：JSON Schema 验证

在 settings.json 中添加 `$schema` 行以启用自动完成和验证：

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "allow": [
      "Bash(npm run lint)",
      "Bash(npm run test *)",
      "Read(~/.zshrc)"
    ],
    "deny": [
      "Bash(curl *)",
      "Read(./.env)",
      "Read(./.env.*)",
      "Read(./secrets/**)"
    ]
  },
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1"
  }
}
```

<ProTip>
添加 JSON Schema 后，VS Code、Cursor 和其他支持 JSON 架构验证的编辑器可以提供自动完成和内联验证。
</ProTip>

### 步骤 2.3：自动备份

Claude Code 自动创建配置文件的时间戳备份，并保留最近五个备份以防止数据丢失。

## 步骤 3：核心设置配置

### 步骤 3.1：常用设置项

| 设置项 | 描述 | 示例 |
|--------|------|------|
| `apiKeyHelper` | 自定义 API 密钥生成脚本 | `/bin/generate_temp_api_key.sh` |
| `cleanupPeriodDays` | 会话清理周期（默认：30） | `20` |
| `companyAnnouncements` | 启动时显示的公告 | `["欢迎使用！"]` |
| `env` | 环境变量 | `{"FOO": "bar"}` |
| `model` | 默认模型覆盖 | `"claude-sonnet-4-5-20250929"` |
| `outputStyle` | 输出样式 | `"Explanatory"` |
| `language` | 响应语言 | `"japanese"` |
| `alwaysThinkingEnabled` | 默认启用扩展思考 | `true` |
| `showTurnDuration` | 显示响应时间 | `true` |

### 步骤 3.2：配置示例

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "permissions": {
    "allow": [
      "Bash(npm run *)",
      "Read",
      "Edit"
    ],
    "deny": [
      "Bash(curl *)",
      "Read(./.env)",
      "Read(./secrets/**)"
    ]
  },
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1"
  },
  "outputStyle": "Explanatory",
  "language": "zh-CN",
  "alwaysThinkingEnabled": true
}
```

<AdPlaceholder />

## 步骤 4：权限系统配置

### 步骤 4.1：权限规则语法

权限规则遵循格式 `Tool` 或 `Tool(specifier)`：

| 规则示例 | 效果 |
|----------|------|
| `Bash` | 匹配所有 Bash 命令 |
| `Bash(npm run *)` | 匹配以 `npm run` 开头的命令 |
| `Read(./.env)` | 匹配读取 `.env 文件` |
| `WebFetch(domain:example.com)` | 匹配对 example.com 的获取请求 |

**规则评估顺序：** 拒绝 → 询问 → 允许

### 步骤 4.2：权限配置示例

```json
{
  "permissions": {
    "allow": [
      "Bash(npm run lint)",
      "Bash(npm run test *)",
      "Bash(git *)",
      "Read",
      "Edit",
      "Glob"
    ],
    "ask": [
      "Bash(git push *)",
      "Bash(git commit *)"
    ],
    "deny": [
      "Bash(curl *)",
      "Bash(wget *)",
      "Read(./.env)",
      "Read(./.env.*)",
      "Read(./secrets/**)",
      "WebFetch"
    ],
    "additionalDirectories": [
      "../shared-utils/"
    ],
    "defaultMode": "acceptEdits"
  }
}
```

### 步骤 4.3：排除敏感文件

使用 `permissions.deny` 阻止访问敏感文件：

```json
{
  "permissions": {
    "deny": [
      "Read(./.env)",
      "Read(./.env.*)",
      "Read(./secrets/**)",
      "Read(./config/credentials.json)",
      "Read(./build)"
    ]
  }
}
```

<ProTip>
匹配的这些模式被排除在文件发现和搜索结果之外，对这些文件的读取操作被拒绝。
</ProTip>

## 步骤 5：沙箱配置

### 步骤 5.1：启用沙箱

```json
{
  "sandbox": {
    "enabled": true,
    "autoAllowBashIfSandboxed": true,
    "excludedCommands": ["git", "docker"]
  }
}
```

### 步骤 5.2：网络配置

```json
{
  "sandbox": {
    "enabled": true,
    "network": {
      "allowedDomains": ["github.com", "*.npmjs.org"],
      "allowUnixSockets": ["~/.ssh/agent-socket"],
      "allowLocalBinding": true
    }
  }
}
```

## 步骤 6：Subagent 配置

### 步骤 6.1：Subagent 存储位置

- **用户 subagents**：`~/.claude/agents/` - 在所有项目中可用
- **项目 subagents**：`.claude/agents/` - 特定于项目，可与团队共享

### 步骤 6.2：创建自定义 Subagent

在 `agents/` 目录中创建 Markdown 文件：

```markdown
---
name: code-reviewer
description: 专业代码审查助手
tools: Read, Grep, Glob
model: sonnet
---

# 代码审查助手

当审查代码时：
1. 分析代码质量和可读性
2. 检查安全问题
3. 评估性能影响
4. 提供改进建议
```

## 步骤 7：插件配置

### 步骤 7.1：启用插件

```json
{
  "enabledPlugins": {
    "formatter@team-tools": true,
    "deployment-tools@team-tools": true,
    "experimental-features@personal": false
  }
}
```

### 步骤 7.2：配置额外市场

```json
{
  "extraKnownMarketplaces": {
    "acme-tools": {
      "source": {
        "source": "github",
        "repo": "acme-corp/claude-plugins"
      }
    }
  }
}
```

<ProTip>
当存储库包含 `extraKnownMarketplaces` 时，团队成员会被提示安装市场和插件。
</ProTip>

## 步骤 8：环境变量配置

### 步骤 8.1：常用环境变量

| 变量 | 描述 |
|------|------|
| `ANTHROPIC_API_KEY` | API 密钥 |
| `ANTHROPIC_MODEL` | 要使用的模型 |
| `CLAUDE_CODE_ENABLE_TELEMETRY` | 启用遥测 |
| `BASH_DEFAULT_TIMEOUT_MS` | 默认超时 |
| `CLAUDE_AUTOCOMPACT_PCT_OVERRIDE` | 压缩阈值 |

### 步骤 8.2：在设置中配置环境变量

```json
{
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1",
    "ANTHROPIC_MODEL": "claude-sonnet-4-20250501",
    "BASH_DEFAULT_TIMEOUT_MS": "120000"
  }
}
```

## 专业提示

### 提示 1：使用 Local 作用域进行实验

在将配置分享给团队之前，先在 Local 作用域中测试：

```json
// .claude/settings.local.json
{
  "outputStyle": "Explanatory",
  "alwaysThinkingEnabled": true
}
```

<ProTip>
Local 作用域的配置不会被提交到版本控制，非常适合个人实验。
</ProTip>

### 提示 2：组织权限规则

按工具类型组织权限规则：

```json
{
  "permissions": {
    "allow": [
      // Bash 命令
      "Bash(npm run *)",
      "Bash(git *)",
      // 文件操作
      "Read",
      "Edit",
      // 搜索
      "Glob",
      "Grep"
    ],
    "deny": [
      // 敏感文件
      "Read(./.env*)",
      "Read(./secrets/**)",
      // 危险命令
      "Bash(rm -rf *)",
      "Bash(format *)"
    ]
  }
}
```

### 提示 3：善用公司公告

使用 `companyAnnouncements` 保持团队信息同步：

```json
{
  "companyAnnouncements": [
    "欢迎来到新项目！请查看代码规范文档。",
    "提醒：本月代码审查将于周五截止。",
    "重要：新的安全政策已生效。"
  ]
}
```

### 提示 4：配置归属信息

自定义 git 提交和 PR 的归属：

```json
{
  "attribution": {
    "commit": "🤖 Generated with Claude Code\n\nCo-Authored-By: AI <ai@company.com>",
    "pr": "🤖 Generated with Claude Code"
  }
}
```

## 常见问题排查

### 问题 1：配置不生效

**解决方案：**
1. 检查配置文件路径是否正确
2. 验证 JSON 语法是否有效
3. 确认作用域优先级是否正确
4. 重启 Claude Code 会话

### 问题 2：权限被拒绝

**解决方案：**
1. 检查 deny 规则是否覆盖了 allow 规则
2. 确认规则语法是否正确
3. 验证项目设置是否覆盖了用户设置
4. 使用 `/permissions` 命令检查当前权限状态

### 问题 3：Managed 设置无法覆盖

**解决方案：**
1. Managed 设置具有最高优先级，无法被覆盖
2. 联系系统管理员请求更改
3. 使用 Local 作用域进行个人调整

### 问题 4：JSON Schema 验证失败

**解决方案：**
1. 检查 $schema URL 是否正确
2. 验证所有属性名称和类型
3. 参考官方 JSON Schema 文档
4. 使用在线 JSON 验证工具

## 结论

掌握 Claude Code 的配置系统是深度定制使用体验的关键。通过本指南的学习，您已经了解了：

- ✅ 四种配置作用域及其优先级
- ✅ 设置文件的结构和位置
- ✅ 权限系统的配置方法
- ✅ 沙箱和网络配置
- ✅ Subagent 和插件配置
- ✅ 环境变量设置

<ProTip>
合理的配置可以让 Claude Code 更好地适应您的工作流程，提升开发效率。
</ProTip>

<AdPlaceholder />