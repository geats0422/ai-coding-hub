---
title: "Claude Code 内存管理完全指南：CLAUDE.md 与模块化规则系统"
description: "学习如何在 Claude Code 中管理内存，包括企业策略、项目内存、用户偏好和模块化规则系统，提升 AI 助手的上下文理解能力。"
date: "2026-02-10"
tool: "Claude Code"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code 内存管理完全指南：CLAUDE.md 与模块化规则系统

有效的内存管理是充分发挥 Claude Code 潜力的关键。通过精心设计的内存系统，您可以让 Claude 在会话中记住项目约定、编码标准和常用命令，大幅提升开发效率和代码质量。

<AdPlaceholder />

## 前置条件

在学习内存管理之前，请确保您具备以下条件：

- **Claude Code**：已安装并可运行的 Claude Code
- **Markdown 基础**：了解基本的 Markdown 语法
- **项目经验**：有参与团队项目的经验
- **编辑器**：支持 Markdown 语法高亮的代码编辑器

## 步骤 1：理解内存类型

### 步骤 1.1：四种内存位置

Claude Code 提供四个内存位置，形成层次结构：

| 内存类型 | 位置 | 用途 | 共享范围 |
|----------|------|------|----------|
| **企业策略** | 系统级路径 | IT 管理的组织说明 | 所有用户 |
| **项目内存** | `./CLAUDE.md` 或 `./.claude/CLAUDE.md` | 团队共享说明 | 团队成员 |
| **项目规则** | `./.claude/rules/*.md` | 模块化主题规则 | 团队成员 |
| **用户内存** | `~/.claude/CLAUDE.md` | 个人偏好设置 | 仅本人 |
| **本地内存** | `./CLAUDE.local.md` | 项目特定偏好 | 仅本人 |

<ProTip>
更高优先级的内存先加载，为更具体的内存提供基础。
</ProTip>

### 步骤 1.2：企业策略位置

**macOS：**
```
/Library/Application Support/ClaudeCode/CLAUDE.md
```

**Linux：**
```
/etc/claude-code/CLAUDE.md
```

**Windows：**
```
C:\Program Files\ClaudeCode\CLAUDE.md
```

<Note>
企业策略由 IT 部门管理，包含公司编码标准、安全策略和合规要求。
</Note>

### 步骤 1.3：项目内存位置

项目内存可以存储在两个位置：

```
./CLAUDE.md
# 或
./.claude/CLAUDE.md
```

<ProTip>
两种位置效果相同，选择适合您项目结构的即可。
</ProTip>

### 步骤 1.4：本地内存位置

本地内存存储在：
```
./CLAUDE.local.md
```

<Note>
此文件自动添加到 .gitignore，是私有项目偏好的理想选择。
</Note>

## 步骤 2：理解加载优先级

### 步骤 2.1：优先级顺序

内存按以下优先级顺序加载：

1. **企业策略**（最高）- 无法被覆盖
2. **项目内存** - 团队共享的说明
3. **项目规则** - 模块化规则
4. **用户内存** - 个人偏好
5. **本地内存**（最低）- 项目特定偏好

### 步骤 2.2：层级覆盖

当多个层级存在相同设置时，更高优先级的设置覆盖较低优先级的设置：

```
企业策略（公司编码标准）
    ↓ 覆盖
项目内存（团队编码标准）
    ↓ 覆盖
用户内存（个人偏好）
```

<ProTip>
合理利用优先级可以让组织策略和个人偏好和谐共存。
</ProTip>

## 步骤 3：创建项目内存

### 步骤 3.1：使用 /init 命令

使用以下命令为项目创建 CLAUDE.md：

```bash
/init
```

### 步骤 3.2：手动创建

在项目根目录创建 `CLAUDE.md`：

```markdown
# 项目名称

## 项目概述
简要描述项目的目的和主要功能。

## 编码标准
- 使用 2 空格缩进
- 所有函数必须包含 JSDoc 注释
- 变量命名使用 camelCase

## 常用命令
```bash
# 安装依赖
npm install

# 运行测试
npm test

# 代码检查
npm run lint
```

## Git 工作流
1. 从 main 分支创建功能分支
2. 提交前运行测试
3. 创建 Pull Request 进行代码审查
```

<ProTip>
详细的 CLAUDE.md 可以大幅减少团队成员的学习成本。
</ProTip>

### 步骤 3.3：推荐的内存内容

**应该包含的信息：**

- 项目架构概述
- 编码风格和约定
- 常用命令和脚本
- 测试要求
- 重要的设计模式
- API 标准
- Git 工作流

**不应该包含的信息：**

- 过时的信息
- 与项目无关的通用知识
- 敏感凭证信息

## 步骤 4：使用模块化规则

### 步骤 4.1：创建规则目录

对于较大项目，使用 `.claude/rules/` 目录组织规则：

```
your-project/
├── .claude/
│   ├── CLAUDE.md
│   └── rules/
│       ├── code-style.md
│       ├── testing.md
│       └── security.md
```

<ProTip>
模块化规则让大型项目的内存管理更加清晰和可维护。
</ProTip>

### 步骤 4.2：创建特定规则文件

**code-style.md：**
```markdown
# 代码风格规范

## 通用规则
- 使用 ESLint 进行代码检查
- 遵循项目现有的代码风格

## TypeScript
- 所有函数必须有类型签名
- 使用 interface 而非 type 定义对象类型
- 禁止使用 any

## React 组件
- 使用函数式组件
- 组件文件使用 PascalCase 命名
- hooks 使用 use 前缀
```

**testing.md：**
```markdown
# 测试规范

## 测试要求
- 所有新功能必须有单元测试
- 测试覆盖率不低于 80%
- 使用 Jest 作为测试框架

## 测试命名
- 测试文件使用 .test.ts 或 .spec.ts 后缀
- 测试描述使用中文或英文，保持一致
```

### 步骤 4.3：使用路径限定规则

规则可以使用 `paths` 字段限定到特定文件：

```markdown
---
paths: src/api/**/*.ts
---

# API 开发规则

- 所有 API 端点必须包含输入验证
- 使用标准错误响应格式
- 包含 OpenAPI 文档注释
```

**支持的 Glob 模式：**

| 模式 | 匹配范围 |
|------|----------|
| `**/*.ts` | 所有 TypeScript 文件 |
| `src/**/*` | src 目录下的所有文件 |
| `*.md` | 项目根目录的 Markdown 文件 |
| `src/components/*.tsx` | 特定目录的 React 组件 |

<ProTip>
路径限定让规则更加精确，避免不必要的上下文干扰。
</ProTip>

### 步骤 4.4：多模式匹配

使用大括号组合多个模式：

```markdown
---
paths: src/**/*.{ts,tsx}
---

# TypeScript/React 规则
```

或使用逗号分隔：

```markdown
---
paths: {src,lib}/**/*.ts, tests/**/*.test.ts
---

# 测试相关规则
```

## 步骤 5：使用导入功能

### 步骤 5.1：导入语法

CLAUDE.md 可以使用 `@path/to/import` 语法导入其他文件：

```markdown
See @README for project overview and @package.json for available npm commands.

# Additional Instructions
- git workflow @docs/git-instructions.md
```

### 步骤 5.2：导入用户文件

导入主目录中的文件是提供个人说明的便捷方式：

```markdown
# 个人偏好
@~/.claude/my-project-instructions.md
```

<Note>
导入不会在 markdown 代码跨度和代码块内进行评估，避免与代码示例冲突。
</Note>

### 步骤 5.3：递归导入

导入的文件可以递归导入其他文件，最大深度为 5 层。

<ProTip>
合理使用导入可以保持主文件的简洁，同时充分利用现有文档。
</ProTip>

## 步骤 6：使用 /memory 命令

### 步骤 6.1：打开内存编辑器

使用 `/memory` 命令在系统编辑器中打开内存文件：

```bash
/memory
```

### 步骤 6.2：查看已加载的内存

运行 `/memory` 可以查看当前加载了哪些内存文件：

```bash
/memory
# 显示加载的内存列表
```

<ProTip>
定期检查加载的内存有助于诊断上下文问题。
</ProTip>

## 步骤 7：组织级内存管理

### 步骤 7.1：设置企业策略

1. 在系统路径创建 CLAUDE.md
2. 使用配置管理系统分发（MDM、组策略、Ansible 等）
3. 确保所有开发人员计算机一致

### 步骤 7.2：企业策略内容

```markdown
# 公司编码标准

## 安全要求
- 禁止硬编码 API 密钥
- 所有用户输入必须验证
- 使用 HTTPS 进行网络请求

## 代码质量
- 关键路径必须有测试覆盖
- 禁止提交未解决的 TODO
- 遵循 SOLID 原则

## 合规要求
- 敏感数据必须加密存储
- 遵守数据隐私法规
```

<ProTip>
企业策略应该是不可覆盖的基准，确保整个组织的一致性。
</ProTip>

## 步骤 8：使用符号链接

### 步骤 8.1：共享规则

使用符号链接在多个项目中共享常见规则：

```bash
# 符号链接共享规则目录
ln -s ~/shared-claude-rules .claude/rules/shared

# 符号链接单个规则文件
ln -s ~/company-standards/security.md .claude/rules/security.md
```

### 步骤 8.2：注意事项

- 符号链接会被解析，其内容正常加载
- 循环符号链接会被检测并妥善处理
- 确保共享路径对所有用户可访问

<ProTip>
符号链接是跨项目复用规则的强大方式。
</ProTip>

## 步骤 9：用户级规则

### 步骤 9.1：创建用户规则

在 `~/.claude/rules/` 中创建适用于所有项目的规则：

```
~/.claude/rules/
├── preferences.md    # 个人编码偏好
└── workflows.md     # 常用工作流
```

### 加载顺序：
1. 用户级规则（最先加载）
2. 项目规则
3. 项目内存

<Note>
项目规则优先级高于用户规则，确保团队标准优先。
</Note>

<AdPlaceholder />

## 专业提示

### 提示 1：保持内存简洁

**好的示例：**
```markdown
# 编码标准
- 使用 2 空格缩进
- 函数必须有 JSDoc
- 变量 camelCase
```

**不好的示例：**
```markdown
# 编码标准
这个项目的编码标准很重要，我们希望大家都能遵守。
首先，缩进应该使用 2 个空格，不要使用 Tab...
```

<ProTip>
简洁明确的规则更容易被 Claude 理解和遵循。
</ProTip>

### 提示 2：使用结构化格式

将内存组织为清晰的层次结构：

```markdown
# 项目规范

## 编码风格
### TypeScript
- 规则 1
- 规则 2

### CSS
- 规则 1
- 规则 2

## Git 工作流
- 规则 1
- 规则 2
```

### 提示 3：定期审查更新

随着项目发展更新内存：
- 每季度审查一次内存内容
- 删除过时的规则
- 添加新功能的规范
- 确保与当前代码实践一致

### 提示 4：善用本地内存

使用 `CLAUDE.local.md` 存储：
- 个人偏好的测试数据
- 沙箱环境配置
- 不适合分享的调试设置

```markdown
# 本地偏好

## 测试数据
- 使用测试数据库：localhost:27017/test_local
- 测试用户：test@example.com

## 调试设置
- 开启详细日志
- 使用本地 API Mock
```

<ProTip>
本地内存不参与版本控制，非常适合个人设置。
</ProTip>

## 常见问题排查

### 问题 1：内存未加载

**解决方案：**
1. 检查文件路径是否正确
2. 确认文件名拼写（CLAUDE.md 非 Claude.md）
3. 运行 `/memory` 查看加载状态
4. 验证文件格式是否为有效 Markdown

### 问题 2：规则冲突

**解决方案：**
1. 了解优先级规则
2. 企业策略不可覆盖
3. 项目规则优先于用户规则
4. 使用更高优先级的文件覆盖

### 问题 3：导入不工作

**解决方案：**
1. 检查导入路径是否正确
2. 确认被导入文件存在
3. 检查递归深度（最大 5 层）
4. 验证是否在代码块内（导入在代码块内不生效）

### 问题 4：路径规则不匹配

**解决方案：**
1. 使用绝对路径测试 Glob 模式
2. 确认路径分隔符正确（Unix 用 `/`，Windows 也用 `/`）
3. 测试模式匹配是否如预期

## 结论

掌握 Claude Code 的内存管理系统是提升 AI 助手效率的关键。通过本指南的学习，您已经了解了：

- ✅ 四种内存类型及其优先级
- ✅ 创建和维护 CLAUDE.md
- ✅ 使用模块化规则系统
- ✅ 导入和引用其他文件
- ✅ 组织级内存管理
- ✅ 符号链接和用户规则

<ProTip>
精心设计的内存系统可以让 Claude 更好地理解您的项目，减少重复说明，提升协作效率。
</ProTip>

<AdPlaceholder />