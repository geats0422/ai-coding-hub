---
title: "连接外部工具"
description: "了解如何使用模型上下文协议 (MCP) 连接外部工具和服务，扩展 Codex 的能力"
tool: "codex"
slug: "mcp"
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

# 模型上下文协议

模型上下文协议 (MCP) 将模型连接到工具和上下文。使用它为 Codex 提供对第三方文档的访问，或让它与浏览器或 Figma 等开发工具交互。

Codex 在 CLI 和 IDE 扩展中都支持 MCP 服务器。

<AdPlaceholder />

## 支持的 MCP 功能

- **STDIO 服务器**：作为本地进程运行的服务器（由命令启动）。
  - 环境变量
- **可流式 HTTP 服务器**：您访问的地址的服务器。
  - Bearer 令牌身份验证
  - OAuth 身份验证（运行 `codex mcp login <server-name>` 用于支持 OAuth 的服务器）

## 将 Codex 连接到 MCP 服务器

Codex 将 MCP 配置存储在 `config.toml` 中，与其他 Codex 配置设置一起。默认为 `~/.codex/config.toml`，但您也可以将 MCP 服务器作用域到具有 `.codex/config.toml` 的项目（仅限可信项目）。

CLI 和 IDE 扩展共享此配置。一旦配置了 MCP 服务器，您可以在两个 Codex 客户端之间切换而无需重新设置。

要配置 MCP 服务器，选择一个选项：

1. **使用 CLI：** 运行 `codex mcp` 以添加和管理服务器。
2. **编辑 `config.toml`：** 直接更新 `~/.codex/config.toml`（或可信项目中的项目作用域 `.codex/config.toml`）。

### 使用 CLI 配置

#### 添加 MCP 服务器

```bash
codex mcp add <server-name> --env VAR1=VALUE1 --env VAR2=VALUE2 -- <stdio server-command>
```

例如，要添加 Context7（用于开发者文档的免费 MCP 服务器），您可以运行以下命令：

```bash
codex mcp add context7 -- npx -y @upstash/context7-mcp
```

#### 其他 CLI 命令

要查看所有可用的 MCP 命令，您可以运行 `codex mcp --help`。

#### 终端 UI (TUI)

在 `codex` TUI 中，使用 `/mcp` 查看您活动的 MCP 服务器。

### 使用 config.toml 配置

要更精细地控制 MCP 服务器选项，编辑 `~/.codex/config.toml`（或项目作用域的 `.codex/config.toml`）。在 IDE 扩展中，从齿轮菜单中选择 **MCP 设置** > **打开 config.toml**。

使用配置文件中的 `[mcp_servers.<server-name>]` 表配置每个 MCP 服务器。

#### STDIO 服务器

- `command`（必需）：启动服务器的命令。
- `args`（可选）：传递给服务器的参数。
- `env`（可选）：为服务器设置的环境变量。
- `env_vars`（可选）：允许和转发的环境变量。
- `cwd`（可选）：启动服务器的工作目录。

#### 可流式 HTTP 服务器

- `url`（必需）：服务器地址。
- `bearer_token_env_var`（可选）：要在 `Authorization` 中发送的 bearer 令牌的环境变量名称。
- `http_headers`（可选）：标头名称到静态值的映射。
- `env_http_headers`（可选）：标头名称到环境变量名称的映射（值从环境中拉取）。

#### 其他配置选项

- `startup_timeout_sec`（可选）：服务器启动超时（秒）。默认：`10`。
- `tool_timeout_sec`（可选）：服务器运行工具的超时（秒）。默认：`60`。
- `enabled`（可选）：设置为 `false` 以禁用服务器而不删除它。
- `required`（可选）：设置为 `true` 以使启用此服务器时启动失败。
- `enabled_tools`（可选）：工具允许列表。
- `disabled_tools`（可选）：工具拒绝列表（在 `enabled_tools` 之后应用）。

如果您的 OAuth 提供商需要静态回调 URI，在 `config.toml` 中设置顶级 `mcp_oauth_callback_port`。如果未设置，Codex 会绑定到临时端口。

#### config.toml 示例

```toml
[mcp_servers.context7]
command = "npx"
args = ["-y", "@upstash/context7-mcp"]

[mcp_servers.context7.env]
MY_ENV_VAR = "MY_ENV_VALUE"
```

```toml
[mcp_servers.figma]
url = "https://mcp.figma.com/mcp"
bearer_token_env_var = "FIGMA_OAUTH_TOKEN"
http_headers = { "X-Figma-Region" = "us-east-1" }
```

```toml
[mcp_servers.chrome_devtools]
url = "http://localhost:3000/mcp"
enabled_tools = ["open", "screenshot"]
disabled_tools = ["screenshot"] # 在 enabled_tools 之后应用
startup_timeout_sec = 20
tool_timeout_sec = 45
enabled = true
```

## 有用的 MCP 服务器示例

MCP 服务器列表持续增长。以下是一些常见的：

- [OpenAI Docs MCP](https://developers.openai.com/resources/docs-mcp)：搜索和阅读 OpenAI 开发者文档。
- [Context7](https://github.com/upstash/context7)：连接到最新的开发者文档。
- Figma [Local](https://developers.figma.com/docs/figma-mcp-server/local-server-installation/) 和 [Remote](https://developers.figma.com/docs/figma-mcp-server/remote-server-installation/)：访问您的 Figma 设计。
- [Playwright](https://www.npmjs.com/package/@playwright/mcp)：使用 Playwright 控制和检查浏览器。
- [Chrome Developer Tools](https://github.com/ChromeDevTools/chrome-devtools-mcp/)：控制和检查 Chrome。
- [Sentry](https://docs.sentry.io/product/sentry-mcp/#codex)：访问 Sentry 日志。
- [GitHub](https://github.com/github/github-mcp-server)：管理 GitHub，超出 `git` 支持的范围（例如，拉取请求和 Issues）。

<AdPlaceholder />
