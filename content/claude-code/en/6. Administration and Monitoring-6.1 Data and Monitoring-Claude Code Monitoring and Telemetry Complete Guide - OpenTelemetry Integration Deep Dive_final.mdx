---
title: "Claude Code Monitoring and Telemetry Complete Guide: OpenTelemetry Integration Deep Dive"
description: "Learn how to configure OpenTelemetry monitoring for Claude Code, including environment variable setup, metrics export, event tracking, and enterprise-level multi-team telemetry solutions."
date: "2026-02-10"
tool: "Claude Code"
slug: "monitoring-and-telemetry"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code Monitoring and Telemetry Complete Guide

Claude Code supports OpenTelemetry (OTel) metrics and events export, providing organizations with powerful monitoring and observability capabilities. By configuring telemetry system, you can track usage patterns, monitor costs, analyze performance bottlenecks, and generate valuable operational insights. All metrics are exported via OpenTelemetry's standard metrics protocol as time-series data, while events are exported via the log protocol, allowing flexible integration into existing monitoring infrastructure.

<AdPlaceholder />

## Prerequisites

Before configuring monitoring, make sure you meet the following conditions:

- Understanding OpenTelemetry basic concepts
- Command line and environment variable configuration experience
- Understanding monitoring backends (Prometheus, Datadog, etc.)
- For enterprise deployments: Administrator permissions

## Quick Start

### Enable Telemetry

Use environment variable to configure OpenTelemetry collection:

```bash
export CLAUDE_CODE_ENABLE_TELEMETRY=1
```

### Choose Exporter Type

Select appropriate exporter based on your monitoring infrastructure:

```bash
# Options: otlp, prometheus, console
export OTEL_METRICS_EXPORTER=otlp
export OTEL_LOGS_EXPORTER=otlp
```

### Configure OTLP Endpoint

Configure OTLP exporter endpoint information:

```bash
export OTEL_EXPORTER_OTLP_PROTOCOL=grpc
export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
```

### Set Authentication

If authentication is required, configure headers:

```bash
export OTEL_EXPORTER_OTLP_HEADERS="Authorization=Bearer your-token"
```

### Debug Configuration

During setup, use shorter export intervals for debugging:

```bash
export OTEL_METRIC_EXPORT_INTERVAL=10000  # 10 seconds (default: 60000ms)
export OTEL_LOGS_EXPORT_INTERVAL=5000     # 5 seconds (default: 5000ms)
```

## Configuration Details

### Core Environment Variables

| Environment Variable | Description | Example Value |
|---------------------|-------------|-----------------|
| `CLAUDE_CODE_ENABLE_TELEMETRY` | Enable telemetry collection (required) | `1` |
| `OTEL_METRICS_EXPORTER` | Metrics exporter type | `console`, `otlp`, `prometheus` |
| `OTEL_LOGS_EXPORTER` | Logs exporter type | `console`, `otlp` |
| `OTEL_EXPORTER_OTLP_PROTOCOL` | OTLP protocol | `grpc`, `http/json`, `http/protobuf` |
| `OTEL_EXPORTER_OTLP_ENDPOINT` | OTLP collector endpoint | `http://localhost:4317` |
| `OTEL_EXPORTER_OTLP_HEADERS` | OTLP authentication headers | `Authorization=Bearer token` |
| `OTEL_METRIC_EXPORT_INTERVAL` | Metrics export interval (ms) | `5000`, `60000` |
| `OTEL_LOGS_EXPORT_INTERVAL` | Logs export interval (ms) | `1000`, `10000` |
| `CLAUDE_CODE_OTEL_HEADERS_HELPER_DEBOUNCE_MS` | Helper script refresh interval (ms) | `1740000` |

### Protocol and Endpoint Configuration

Support configuring different endpoints and protocols for metrics and logs:

```bash
# Metrics and logs using different backends
export OTEL_EXPORTER_OTLP_METRICS_PROTOCOL=http/protobuf
export OTEL_EXPORTER_OTLP_METRICS_ENDPOINT=http://metrics.company.com:4318
export OTEL_EXPORTER_OTLP_LOGS_PROTOCOL=grpc
export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://logs.company.com:4317
```

### mTLS Authentication

For enterprise environments requiring mutual TLS authentication:

```bash
export OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY=/path/to/client.key
export OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE=/path/to/client.crt
```

## Administrator Configuration

Administrators can configure OpenTelemetry across all users via managed settings:

### Configuration Example

```json
{
  "env": {
    "CLAUDE_CODE_ENABLE_TELEMETRY": "1",
    "OTEL_METRICS_EXPORTER": "otlp",
    "OTEL_LOGS_EXPORTER": "otlp",
    "OTEL_EXPORTER_OTLP_PROTOCOL": "grpc",
    "OTEL_EXPORTER_OTLP_ENDPOINT": "http://collector.company.com:4317",
    "OTEL_EXPORTER_OTLP_HEADERS": "Authorization:Bearer company-token"
  }
}
```

### Priority Behavior

Environment variables defined in managed settings have high priority and cannot be overridden by users, ensuring organization-level security policies and compliance requirements are enforced consistently.

## Metrics Baseline Control

### Control Included Attributes

Manage which attributes are included in exported metrics to control cardinality (uniqueness) and reduce storage costs:

| Environment Variable | Description | Default Value | Disable Example |
|---------------------|-------------|---------|----------|
| `OTEL_METRICS_INCLUDE_SESSION_ID` | Include session.id attribute | `true` | `false` |
| `OTEL_METRICS_INCLUDE_VERSION` | Include app.version attribute | `false` | `true` |
| `OTEL_METRICS_INCLUDE_ACCOUNT_UUID` | Include user.account_uuid attribute | `true` | `false` |

### Cardinality Trade-offs

Lower cardinality means better performance and lower storage costs, but reduces data analysis granularity. Choose appropriate settings based on your monitoring backend capabilities and analysis needs.

## Available Metrics

### Standard Attributes

All metrics and events share these standard attributes:

| Attribute | Description | Availability |
|-----------|-------------|--------------|
| `session.id` | Unique session identifier | Present in all metrics and events |
| `app.version` | Claude Code version | Present in all metrics and events |
| `organization.id` | Organization UUID | Present if authenticated |
| `user.account_uuid` | Account UUID | Present if authenticated |
| `terminal.type` | Terminal type | Present if detected |
| `os.type`, `os.version` | OS information | Always present |
| `host.arch` | Host architecture | Always present |
| `service.name` | Service name | Always `claude-code` |
| `service.version` | Current version | Always present |
| `metering_schema_name` | Schema name | `com.anthropic.claude_code` |

### Core Metrics

| Metric Name | Description | Unit |
|-------------|---------|-------|
| `claude_code.session.count` | Count of started CLI sessions | count |
| `claude_code.lines_of_code.count` | Number of code lines modified | count |
| `claude_code.pull_request.count` | Number of pull requests created | count |
| `claude_code.commit.count` | Number of git commits created | count |
| `claude_code.cost.usage` | Claude Code session cost | USD |
| `claude_code.token.usage` | Number of tokens used | tokens |
| `claude_code.code_edit_tool.decision` | Count of code edit tool permission decisions | count |
| `claude_code.active_time.total` | Total active time | s |

### Metric Details

**Session counter**: Increments on each session start, tracking overall usage trends.

**Lines of code counter**: Increments when code is added or deleted, with `type` attribute indicating `added` or `removed`.

**Cost counter**: Increments after each API request, contains `model` attribute identifying which model was used.

**Token counter**: Tracks input, output, cache read, and cache creation tokens, with `type` distinguishing between different token types.

**Active time counter**: Tracks time user is actively using Claude Code (excludes idle time).

## Event Tracking

### User Prompt Event

Records timestamp when user submits a prompt to Claude.

**Event name**: `claude_code.user_prompt`

**Attributes**:
- `prompt_length`: Length of the prompt
- `prompt`: Full prompt content (requires `OTEL_LOG_USER_PROMPTS=1`)

### Tool Result Event

Records details when a tool completes execution.

**Event name**: `claude_code.tool_result`

**Attributes**:
- `tool_name`: Identifies the tool
- `success`: Indicates success or failure
- `duration_ms`: Execution time in milliseconds
- `error`: Error message if failed
- `decision`: User permission decision

### API Request Event

Generates detailed record for each Claude API request.

**Event name**: `claude_code.api_request`

**Attributes**:
- `model`: Model identifier
- `cost_usd`: Estimated cost in USD
- `duration_ms`: Request duration
- `input_tokens`, `output_tokens`: Token usage
- `cache_read_tokens`, `cache_creation_tokens`: Cache efficiency metrics

### API Error Event

Records API request failures.

**Event name**: `claude_code.api_error`

**Attributes**:
- `error`: Error message
- `status_code`: HTTP status code
- `attempt`: Retry attempt count

### Tool Decision Event

Records permission decisions for tool usage.

**Event name**: `claude_code.tool_decision`

**Attributes**:
- `tool_name`: Tool that was requested
- `decision`: Decision result
- `source`: `config`, `user_permanent`, `user_temporary`, `user_abort`, or `user_reject`

### Notification Events

Records various notification events from Claude Code.

| Event Type | Description | Attributes |
|------------|-------------|------------|
| `permission_prompt` | Shown when asking for user approval | `prompt_length` only |
| `idle_prompt` | Shown after 60 seconds of inactivity | None |
| `auth_success` | Shown on successful authentication | None |
| `elicitation_dialog` | Shown for MCP tool elicitation | None |

### Session Lifecycle Events

**Event name**: `claude_code.session_start`

Triggered when a session starts or resumes.

**Attributes**:
- `reason`: `startup`, `resume`, `clear`, `compact`

**Event name**: `claude_code.session_end`

**Triggered when a session ends.

**Attributes**:
- `reason`: `clear`, `logout`, `prompt_input_exit`, `other`

## Dynamic Header Configuration

### Enterprise Environment Setup

For environments requiring dynamic authentication, configure a script to generate headers dynamically.

### Configuration Method

Add to settings:

```json
{
  "otelHeadersHelper": "/bin/generate_opentelemetry_headers.sh"
}
```

### Script Requirements

Script must output valid JSON with HTTP header key-value pairs:

```bash
#!/bin/bash
echo "{\"Authorization\": \"Bearer $(get-token.sh)\", \"X-API-Key\": \"$(get-api-key.sh)\"}"
```

### Refresh Behavior

Headers helper script runs at startup and periodically (default every 29 minutes) to support token refresh.

## Multi-Team Organization Support

### Custom Attributes

Use `OTEL_RESOURCE_ATTRIBUTES` to add custom attributes distinguishing different teams or departments:

```bash
export OTEL_RESOURCE_ATTRIBUTES="department=engineering,team.id=platform,cost_center=eng-123"
```

### Format Requirements

Strict W3C Baggage specification:
- Values cannot contain spaces
- Must be comma-separated key=value pairs
- Only US-ASCII characters (excluding control characters, spaces, quotes, commas, semicolons, backslashes)
- Special characters must be percent-encoded

### Examples

```bash
# Invalid - contains spaces
export OTEL_RESOURCE_ATTRIBUTES="org.name=John's Organization"

# Valid - using underscores
export OTEL_RESOURCE_ATTRIBUTES="org.name=Johns_Organization"

# Valid - percent encoding
export OTEL_RESOURCE_ATTRIBUTES="org.name=John%27s%20Organization"
```

## Practical Configuration Examples

### Console Debugging

```bash
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_METRICS_EXPORTER=console
export OTEL_METRIC_EXPORT_INTERVAL=1000
```

### OTLP/gRPC Export

```bash
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_METRICS_EXPORTER=otlp
export OTEL_LOGS_EXPORTER=otlp
export OTEL_EXPORTER_OTLP_PROTOCOL=grpc
export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
```

### Prometheus Export

```bash
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_METRICS_EXPORTER=prometheus
```

### Multiple Exporters

```bash
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_METRICS_EXPORTER=console,otlp
export OTEL_LOGS_EXPORTER=otlp
export OTEL_EXPORTER_OTLP_PROTOCOL=http/json
```

### Metrics Only or Logs Only

```bash
# Metrics only
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_METRICS_EXPORTER=otlp
export OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317

# Logs only
export CLAUDE_CODE_ENABLE_TELEMETRY=1
export OTEL_LOGS_EXPORTER=otlp
export OTEL_EXPORTER_OTLP_PROTOCOL=grpc
export OTEL_EXPORTER_OTLP_LOGS_ENDPOINT=http://localhost:4317
```

## Metrics and Event Data Analysis

### Usage Monitoring

Track these metrics to understand adoption and engagement:
- `claude_code.session.count`: Overall adoption trends
- `claude_code.token.usage`: By user, by model, over time
- `claude_code.active_time.total`: Engagement depth

### Cost Monitoring

`claude_code.cost.usage` metric helps track spending and identify high-cost sessions, enabling better budget planning.

### Event Analysis

**Tool usage patterns**: Analyze `claude_code.tool_result` events to:
  - Identify most frequently used tools
  - Calculate success rates
  - Measure average execution times

**Performance monitoring**: Track API request durations (`claude_code.api_request.duration_ms`) to identify bottlenecks.

## Backend Selection Guide

### Metrics Backend

- **Time series databases** (Prometheus): Best for rate calculations, aggregations, and alerting
- **Columnar stores** (ClickHouse, BigQuery): Excellent for complex queries and unique user analysis
- **Observability platforms** (Datadog, Honeycomb): Provide advanced querying, visualization, and correlation features

### Event and Log Backends

- **Log aggregation systems** (Elasticsearch, Loki): Best for full-text search and log correlation
- **Observability platforms**: Support metric-event correlation across logs and traces

### Choosing Based on Use Case

| Need | Recommended Backend | Best for |
|------|---------------------|----------|
| DAU/WAU | Time series, metrics | Cost tracking |
| Unique users | Columnar stores, Observability platforms | DAU/WAU + Observability |
| Cost optimization | Metrics export only, simple aggregation | Cost control |

## Security and Privacy

### Privacy Protection

- Telemetry is optional and requires explicit configuration
- Sensitive information (API keys, file contents, user prompts) is never included in metrics or events
- User prompt content is only logged when explicitly enabled (`OTEL_LOG_USER_PROMPTS=1`)

### User Prompt Logging

To enable user prompt logging:

```bash
export OTEL_LOG_USER_PROMPTS=1
```

<Note>
Enable this only if it complies with your organization's data protection policies. Sensitive prompt logging can increase token usage significantly.
</Note>

## Summary

Claude Code's OpenTelemetry integration provides enterprise-grade monitoring capabilities. By properly configuring metrics and events export, you can gain:

- ✅ Real-time visibility into usage patterns and costs
- ✅ Performance monitoring and bottleneck identification
- ✅ Detailed event tracking for debugging and analysis
- ✅ Flexible backend integration with standard protocols
- ✅ Multi-team support with custom attributes

<ProTip>
Start with console debugging mode to validate configuration, then gradually scale up to production backend based on your organization's needs.
</ProTip>

<AdPlaceholder />
