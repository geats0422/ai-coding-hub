---
title: "Claude Code 模型选择与配置完全指南：优化 AI 推理能力"
description: "深入了解 Claude Code 的模型配置系统，包括模型别名、opusplan 模式、努力级别调整和上下文窗口优化等高级功能。"
date: "2026-02-10"
tool: "Claude Code"
slug: "model-selection-and-configuration"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code 模型选择与配置完全指南：优化 AI 推理能力

选择合适的 AI 模型是优化 Claude Code 使用体验的关键。不同的模型在推理能力、速度和成本方面各有优势。本指南将帮助您根据任务需求选择最佳配置，充分发挥 Claude Code 的潜力。

<AdPlaceholder />

## 前置条件

在学习模型配置之前，请确保您具备以下条件：

- **Claude Code**：已安装并可运行的 Claude Code
- **账户类型**：了解您的 Anthropic 账户类型（Pro、Max、Teams 或 Enterprise）
- **基本概念**：了解 AI 模型和上下文窗口的基本概念
- **使用经验**：有基本的 Claude Code 使用经验

## 步骤 1：理解可用模型

### 步骤 1.1：模型类型概述

Claude Code 支持多种模型配置方式：

- **模型别名**：便捷的预设配置
- **完整模型名称**：精确版本控制
- **API 特定标识符**：适用于不同云服务

**模型配置选项：**

| 配置类型 | 描述 | 适用场景 |
|----------|------|----------|
| 模型别名 | 便捷的选择方式 | 日常使用 |
| 完整模型名称 | 精确版本控制 | 生产环境 |
| Bedrock ARN | AWS Bedrock 部署 | 企业部署 |
| Foundry 名称 | Microsoft Foundry | 企业部署 |
| Vertex 版本 | Google Cloud Vertex | 企业部署 |

### 步骤 1.2：模型别名详解

模型别名提供了一种便捷的方式来选择模型设置：

| 模型别名 | 描述 | 适用场景 |
|----------|------|----------|
| `default` | 推荐的默认设置 | 标准任务 |
| `sonnet` | 最新 Sonnet 模型（Sonnet 4.5） | 日常编码任务 |
| `opus` | 最新 Opus 模型（Opus 4.6） | 复杂推理任务 |
| `haiku` | 快速高效的 Haiku 模型 | 简单任务 |
| `sonnet[1m]` | Sonnet + 100 万 token 上下文 | 长会话 |
| `opusplan` | 混合模式 | 自动化规划执行 |

<ProTip>
别名始终指向最新版本。要固定到特定版本，请使用完整模型名称。
</ProTip>

### 步骤 1.3：模型能力对比

| 模型 | 推理能力 | 速度 | 成本 | 最佳用途 |
|------|----------|------|------|----------|
| Haiku | 基础 | 最快 | 最低 | 简单任务、快速响应 |
| Sonnet | 中等 | 快 | 中等 | 日常编码、标准任务 |
| Opus | 最强 | 较慢 | 最高 | 复杂推理、架构决策 |

## 步骤 2：配置模型

### 步骤 2.1：配置方式优先级

Claude Code 支持多种配置方式，按优先级排序：

1. **会话期间**：使用 `/model <alias|name>` 动态切换
2. **启动时**：使用 `claude --model <alias|name>` 命令行参数
3. **环境变量**：设置 `ANTHROPIC_MODEL=<alias|name>`
4. **设置文件**：在 `settings.json` 中永久配置

**命令行示例：**
```bash
# 使用 Opus 启动
claude --model opus

# 使用 Sonnet 启动
claude --model sonnet
```

**会话内切换：**
```bash
# 切换到 Sonnet
/model sonnet

# 切换到 Opus
/model opus
```

<ProTip>
会话内切换不会清除当前对话上下文，让模型无缝过渡。
</ProTip>

### 步骤 2.2：设置文件配置

在 `settings.json` 中永久配置默认模型：

```json
{
  "model": "opus"
}
```

### 步骤 2.3：使用环境变量

```bash
# 设置默认模型
export ANTHROPIC_MODEL=opus

# 或者在设置中配置
{
  "env": {
    "ANTHROPIC_MODEL": "opus"
  }
}
```

<AdPlaceholder />

## 步骤 3：使用 opusplan 混合模式

### 步骤 3.1：理解 opusplan

`opusplan` 是一种智能混合模式，结合了两种模型的优势：

- **计划模式**：使用 Opus 进行复杂推理和架构决策
- **执行模式**：自动切换到 Sonnet 进行代码生成和实现

**工作流程：**
```
用户请求 → Opus 规划 → Sonnet 执行 → 返回结果
```

<ProTip>
opusplan 让你获得两全其美的体验：Opus 的卓越推理能力用于规划，Sonnet 的效率用于执行。
</ProTip>

### 步骤 3.2：启用 opusplan

```bash
# 命令行启动
claude --model opusplan

# 或在会话中切换
/model opusplan
```

### 步骤 3.3：使用场景

opusplan 特别适合以下场景：

- **复杂功能开发**：需要深入分析和规划的任务
- **架构重构**：涉及多个模块的系统性更改
- **新项目启动**：需要全面考虑的设计决策

## 步骤 4：调整努力级别

### 步骤 4.1：理解努力级别

努力级别控制 Opus 4.6 的自适应推理，根据任务复杂性动态分配思考资源。

| 努力级别 | 描述 | 适用场景 |
|----------|------|----------|
| 低 | 快速响应 | 直接任务、简单查询 |
| 中 | 平衡 | 一般编码任务 |
| 高 | 深入推理 | 复杂问题、架构决策 |

### 步骤 4.2：配置努力级别

**方式一：使用 `/model` 命令**
```bash
/model opus
# 然后使用左右箭头键调整努力级别滑块
```

**方式二：环境变量**
```bash
export CLAUDE_CODE_EFFORT_LEVEL=medium
```

**方式三：设置文件**
```json
{
  "effortLevel": "medium"
}
```

<Note>
努力级别目前仅在 Opus 4.6 上受支持。
</Note>

### 步骤 4.3：选择合适的努力级别

**低努力级别适用：**
- 简单代码修改
- 快速问答
- 文件搜索和阅读
- 常规错误修复

**中努力级别适用：**
- 功能实现
- 代码重构
- 测试编写
- 文档更新

**高努力级别适用：**
- 复杂架构设计
- 多模块协调
- 安全审查
- 性能优化

## 步骤 5：扩展上下文窗口

### 步骤 5.1：理解 100 万 token 上下文

`[1m]` 后缀为长会话启用 100 万 token 上下文窗口。

**使用示例：**
```bash
# 使用 sonnet[1m]
/model sonnet[1m]

# 或附加到完整模型名称
/model claude-sonnet-4-5-20250929[1m]
```

<Note>
对于 Opus 4.6，100 万 token 上下文窗口可供 API 和按使用量付费用户使用。Pro、Max、Teams 和 Enterprise 订阅用户在推出时可能无法访问。
</Note>

### 步骤 5.2：适用场景

扩展上下文窗口特别适合：

- **大型代码库分析**：需要同时理解多个模块
- **长对话会话**：持续多轮讨论
- **文档密集型项目**：需要引用大量文档
- **跨文件重构**：涉及众多相关文件

### 步骤 5.3：成本考虑

扩展上下文模型有[不同的定价](https://platform.claude.com/docs/en/about-claude/pricing#long-context-pricing)。

<ProTip>
仅在真正需要时才使用扩展上下文，以控制成本。
</ProTip>

## 步骤 6：环境变量配置

### 步骤 6.1：别名映射环境变量

使用环境变量控制别名指向的模型：

| 环境变量 | 描述 | 示例值 |
|----------|------|--------|
| `ANTHROPIC_DEFAULT_OPUS_MODEL` | Opus 别名映射 | `claude-opus-4-5-20251101` |
| `ANTHROPIC_DEFAULT_SONNET_MODEL` | Sonnet 别名映射 | `claude-sonnet-4-5-20250929` |
| `ANTHROPIC_DEFAULT_HAIKU_MODEL` | Haiku 别名映射 | `claude-haiku-20250501` |
| `CLAUDE_CODE_SUBAGENT_MODEL` | Subagent 默认模型 | `sonnet` |

### 步骤 6.2：配置示例

```json
{
  "env": {
    "ANTHROPIC_DEFAULT_OPUS_MODEL": "claude-opus-4-5-20251101",
    "ANTHROPIC_DEFAULT_SONNET_MODEL": "claude-sonnet-4-5-20250929",
    "CLAUDE_CODE_SUBAGENT_MODEL": "sonnet"
  }
}
```

<Note>
`ANTHROPIC_SMALL_FAST_MODEL` 已弃用，应使用 `ANTHROPIC_DEFAULT_HAIKU_MODEL`。
</Note>

## 步骤 7：Prompt Caching 配置

### 步骤 7.1：理解 Prompt Caching

Claude Code 自动使用 prompt caching 来优化性能并降低成本。

### 细粒度控制缓存行为的环境变量：

| 环境变量 | 描述 | 示例 |
|----------|------|------|
| `DISABLE_PROMPT_CACHING` | 禁用所有缓存 | `1` |
| `DISABLE_PROMPT_CACHING_HAIKU` | 仅禁用 Haiku 缓存 | `1` |
| `DISABLE_PROMPT_CACHING_SONNET` | 仅禁用 Sonnet 缓存 | `1` |
| `DISABLE_PROMPT_CACHING_OPUS` | 仅禁用 Opus 缓存 | `1` |

### 步骤 7.2：配置示例

```json
{
  "env": {
    "DISABLE_PROMPT_CACHING": "0",
    "DISABLE_PROMPT_CACHING_OPUS": "1"
  }
}
```

<ProTip>
全局设置 `DISABLE_PROMPT_CACHING` 优先于特定模型设置。
</ProTip>

## 步骤 8：检查当前模型

### 方式一：使用状态行

如果已配置状态行，可以直接查看当前模型。

### 方式二：使用 /status 命令

```bash
/status
```

此命令显示：
- 当前使用的模型
- 账户信息
- 连接状态

## 专业提示

### 提示 1：根据任务选择模型

| 任务类型 | 推荐模型 | 原因 |
|----------|----------|------|
| 快速问答 | haiku | 速度最快 |
| 代码阅读 | sonnet | 性价比高 |
| 功能开发 | sonnet 或 opusplan | 平衡效率和质量 |
| 架构设计 | opus | 推理能力最强 |
| 复杂重构 | opusplan | 智能规划执行 |

<ProTip>
建立模型选择决策树，可以帮助团队成员快速做出正确选择。
</ProTip>

### 提示 2：善用 opusplan

opusplan 是处理复杂任务的利器：

```bash
# 对于大型功能开发
/model opusplan
> 实现用户认证模块，包括登录、注册、密码重置功能

# Opus 先进行架构设计
# 然后 Sonnet 执行具体实现
```

### 提示 3：成本优化策略

- **日常任务**：使用 Sonnet
- **复杂任务**：短期使用 Opus
- **简单任务**：使用 Haiku
- **长会话**：选择性使用 `[1m]`

### 提示 4：配置团队标准

在项目级别设置默认模型：

```json
// .claude/settings.json
{
  "model": "opusplan",
  "effortLevel": "medium"
}
```

<ProTip>
团队统一模型配置可以减少混淆，提高协作效率。
</ProTip>

## 常见问题排查

### 问题 1：模型切换不生效

**解决方案：**
1. 检查配置优先级（会话 > 命令行 > 环境变量 > 设置文件）
2. 确认模型名称或别名正确
3. 重启 Claude Code 会话

### 问题 2：达到使用阈值

**解决方案：**
1. Claude Code 可能会自动回退到 Sonnet
2. 考虑使用 Sonnet 处理日常任务
3. 优化提示以减少 token 使用

### 问题 3：努力级别不可用

**解决方案：**
1. 确认使用的是 Opus 4.6
2. 检查 `/model` 命令中是否显示滑块
3. 重启会话尝试

### 问题 4：扩展上下文不可用

**解决方案：**
1. 确认账户类型支持
2. 检查模型版本兼容性
3. 考虑使用替代方案

## 结论

掌握 Claude Code 的模型配置系统是优化开发效率的关键。通过本指南的学习，您已经了解了：

- ✅ 可用的模型类型和别名
- ✅ 多种配置方式和优先级
- ✅ opusplan 混合模式的使用
- ✅ 努力级别的调整方法
- ✅ 扩展上下文窗口的配置
- ✅ Prompt caching 的控制

<ProTip>
根据任务需求灵活选择模型，在效率和能力之间找到最佳平衡点。
</ProTip>

<AdPlaceholder />
