---
title: "Claude Code MCP 集成完全指南：连接外部工具和数据源"
description: "学习如何使用 Model Context Protocol 将 Claude Code 连接到外部工具，包括 GitHub、Sentry、数据库和 API 集成等常用服务。"
date: "2026-02-10"
tool: "Claude Code"
slug: "connect-external-tools"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code MCP 集成完全指南：连接外部工具和数据源

Model Context Protocol（MCP）是一个开源标准，让 Claude Code 能够安全地连接到数百种外部工具、数据源和 API。通过 MCP 集成，您可以要求 Claude 直接与 JIRA、GitHub、数据库等系统交互，大幅提升自动化能力。

<AdPlaceholder />

## 前置条件

在学习 MCP 集成之前，请确保您具备以下条件：

- **Claude Code**：已安装并可运行的 Claude Code
- **命令行基础**：熟悉终端操作
- **API 密钥**：需要集成的服务的访问凭证
- **安全意识**：了解 OAuth 和 API 安全基础知识

## 步骤 1：理解 MCP

### 步骤 1.1：MCP 是什么

MCP（Model Context Protocol）是一个开放标准，用于 AI 助手与外部工具的连接：

- **标准化协议**：统一的方式连接各种工具
- **安全连接**：支持 OAuth 认证
- **动态工具**：工具自动更新，无需重新配置

<ProTip>
MCP 让 Claude 可以访问您的整个工具生态系统，实现真正的自动化工作流。
</ProTip>

### 步骤 1.2：MCP 能做什么

连接 MCP 服务器后，您可以：

| 功能 | 示例 |
|------|------|
| **项目管理** | "添加 JIRA 问题 ENG-4521 中描述的功能" |
| **数据分析** | "检查 Sentry 中最近 24 小时的错误" |
| **数据库查询** | "查询 PostgreSQL 数据库找到活跃用户" |
| **设计集成** | "根据 Figma 设计更新邮件模板" |
| **自动化工作流** | "创建邮件草稿邀请用户参加测试" |

### 步骤 1.3：可用的 MCP 服务器

Claude Code 支持多种类型的 MCP 服务器：

| 服务器类型 | 示例 | 使用场景 |
|-----------|------|----------|
| HTTP 服务器 | GitHub、Sentry | 云服务集成 |
| SSE 服务器 | Asana（旧版） | 实时推送 |
| Stdio 服务器 | 文件系统、数据库 | 本地工具 |

## 步骤 2：安装 MCP 服务器

### 步骤 2.1：HTTP 服务器安装（推荐）

HTTP 服务器是连接到远程 MCP 服务器的推荐方式：

```bash
# 基本语法
claude mcp add --transport http <name> <url>

# 真实示例：连接 Notion
claude mcp add --transport http notion https://mcp.notion.com/mcp

# 带有 Bearer 令牌的示例
claude mcp add --transport http secure-api https://api.example.com/mcp \
  --header "Authorization: Bearer your-token"
```

<ProTip>
HTTP 服务器是云服务的最佳选择，支持自动重连和负载均衡。
</ProTip>

### 步骤 2.2：Stdio 服务器安装

Stdio 服务器作为本地进程运行：

```bash
# 基本语法
claude mcp add [options] <name> -- <command> [args...]

# 真实示例：添加 Airtable 服务器
claude mcp add --transport stdio --env AIRTABLE_API_KEY=YOUR_KEY airtable \
  -- npx -y airtable-mcp-server
```

<Note>
**重要**：所有选项必须在服务器名称之前，`--` 用于分隔 MCP 选项和服务器参数。
</Note>

### 步骤 2.3：Windows 特殊配置

Windows 用户需要注意：

```bash
# 使用 npx 时需要 cmd /c 包装器
claude mcp add --transport stdio my-server -- cmd /c npx -y @some/package
```

<Warning>
如果没有 `cmd /c` 包装器，Windows 用户会遇到"Connection closed"错误。
</Warning>

## 步骤 3：管理 MCP 服务器

### 步骤 3.1：基本管理命令

```bash
# 列出所有配置的服务器
claude mcp list

# 获取特定服务器的详细信息
claude mcp get github

# 删除服务器
claude mcp remove github

# 在 Claude Code 中检查服务器状态
/mcp
```

### 步骤 3.2：动态工具更新

Claude Code 支持 MCP 的 `list_changed` 通知：

- 当服务器发送通知时自动刷新工具
- 无需断开重连
- 工具集自动更新

### 步骤 3.3：超时和输出限制

```bash
# 配置服务器启动超时（毫秒）
MCP_TIMEOUT=10000 claude

# 配置最大输出令牌
MAX_MCP_OUTPUT_TOKENS=50000 claude
```

<ProTip>
对于产生大量输出的服务器（如数据库查询），增加输出限制很有必要。
</ProTip>

## 步骤 4：配置范围

### 步骤 4.1：理解范围类型

MCP 服务器可以在三个范围配置：

| 范围 | 命令 | 存储位置 | 共享范围 |
|------|------|----------|----------|
| **本地** | 默认 | `~/.claude.json` | 仅本人 |
| **项目** | `--scope project` | `.mcp.json` | 团队 |
| **用户** | `--scope user` | `~/.claude.json` | 本人跨项目 |

### 步骤 4.2：本地范围配置

本地范围是默认配置：

```bash
# 添加本地范围的服务器（默认）
claude mcp add --transport http stripe https://mcp.stripe.com

# 显式指定
claude mcp add --transport http stripe --scope local https://mcp.stripe.com
```

<ProTip>
本地范围适合个人开发服务器和实验配置。
</ProTip>

### 步骤 4.3：项目范围配置

项目范围通过 `.mcp.json` 文件启用团队协作：

```bash
# 添加项目范围的服务器
claude mcp add --transport http paypal --scope project https://mcp.paypal.com/mcp
```

**生成的 `.mcp.json` 格式：**
```json
{
  "mcpServers": {
    "shared-server": {
      "command": "/path/to/server",
      "args": [],
      "env": {}
    }
  }
}
```

<Note>
出于安全原因，Claude Code 在使用项目范围服务器前会提示批准。
</Note>

### 步骤 4.4：用户范围配置

用户范围提供跨项目可访问性：

```bash
# 添加用户服务器
claude mcp add --transport http hubspot --scope user https://mcp.hubspot.com/anthropic
```

### 步骤 4.5：优先级规则

当相同名称的服务器存在于多个范围时：

1. **本地范围**（最高优先级）
2. **项目范围**
3. **用户范围**（最低优先级）

<ProTip>
个人配置可以在需要时覆盖共享配置。
</ProTip>

<AdPlaceholder />

## 步骤 5：实际使用示例

### 步骤 5.1：连接 GitHub

```bash
# 1. 添加 GitHub MCP 服务器
claude mcp add --transport http github https://api.githubcopilot.com/mcp/

# 2. 如需认证，在 Claude Code 中使用
> /mcp
# 选择 GitHub 进行认证

# 3. 使用示例
> "Review PR #456 and suggest improvements"
> "Create a new issue for the bug"
> "Show me all open PRs assigned to me"
```

### 步骤 5.2：连接 Sentry 监控

```bash
# 1. 添加 Sentry MCP 服务器
claude mcp add --transport http sentry https://mcp.sentry.dev/mcp

# 2. 使用 /mcp 进行认证
> /mcp

# 3. 调试生产问题
> "What are the most common errors in the last 24 hours?"
> "Show me the stack trace for error ID abc123"
> "Which deployment introduced these new errors?"
```

### 步骤 5.3：连接 PostgreSQL 数据库

```bash
# 1. 使用连接字符串添加数据库服务器
claude mcp add --transport stdio db -- npx -y @bytebase/dbhub \
  --dsn "postgresql://readonly:pass@prod.db.com:5432/analytics"

# 2. 自然语言查询
> "What's our total revenue this month?"
> "Show me the schema for the orders table"
> "Find customers who haven't made a purchase in 90 days"
```

### 步骤 5.4：连接 Slack 通知

```bash
# 添加 Slack MCP 服务器
claude mcp add --transport http slack https://mcp.slack.com/mcp

# 发送通知
> "Send a channel message to #engineering about the deployment"
> "Create a thread in the production-incidents channel"
```

## 步骤 6：使用 MCP 资源

### 步骤 6.1：引用 MCP 资源

MCP 服务器可以暴露资源，使用 `@` 语法引用：

```bash
# 查看可用资源
> @

# 引用特定资源
> "Can you analyze @github:issue://123 and suggest a fix?"

> "Please review the API documentation at @docs:file://api/authentication"
```

### 步骤 6.2：多资源引用

```bash
# 比较多个资源
> "Compare @postgres:schema://users with @docs:file://database/user-model"
```

<ProTip>
资源引用让 Claude 可以访问 MCP 服务器提供的任何类型的内容。
</ProTip>

## 步骤 7：使用 MCP 提示

### 步骤 7.1：执行 MCP 提示

MCP 服务器可以暴露提示作为斜杠命令：

```bash
# 发现可用提示
> /

# 执行不带参数的提示
> /mcp__github__list_prs

# 执行带参数的提示
> /mcp__github__pr_review 456
> /mcp__jira__create_issue "Bug in login flow" high
```

### 步骤 7.2：提示格式

MCP 提示格式为：
```
/mcp__servername__promptname [参数]
```

## 步骤 8：OAuth 认证

### 步骤 8.1：认证流程

许多云服务需要 OAuth 认证：

```bash
# 1. 添加需要认证的服务器
claude mcp add --transport http sentry https://mcp.sentry.dev/mcp

# 2. 在 Claude Code 中启动认证
> /mcp

# 3. 按照浏览器中的步骤完成登录
```

### 步骤 8.2：管理认证

- 认证令牌自动安全存储
- 自动刷新过期令牌
- 使用 `/mcp` 中的 "Clear authentication" 撤销访问

## 步骤 9：从其他配置导入

### 步骤 9.1：从 JSON 配置添加

```bash
# 基本语法
claude mcp add-json <name> '<json>'

# HTTP 服务器示例
claude mcp add-json weather-api '{"type":"http","url":"https://api.weather.com/mcp","headers":{"Authorization":"Bearer token"}}'

# Stdio 服务器示例
claude mcp add-json local-weather '{"type":"stdio","command":"/path/to/weather-cli","args":["--api-key","abc123"],"env":{"CACHE_DIR":"/tmp"}}'
```

### 步骤 9.2：从 Claude Desktop 导入

```bash
# 导入所有 Claude Desktop 服务器
claude mcp add-from-claude-desktop

# 选择要导入的服务器
# 已导入的服务器将获得数字后缀（如有重复）
```

<Note>
此功能仅适用于 macOS 和 WSL。
</Note>

## 步骤 10：将 Claude Code 用作 MCP 服务器

### 步骤 10.1：启动 MCP 服务

```bash
# 启动 Claude 作为 stdio MCP 服务器
claude mcp serve
```

### 步骤 10.2：在 Claude Desktop 中配置

```json
{
  "mcpServers": {
    "claude-code": {
      "type": "stdio",
      "command": "claude",
      "args": ["mcp", "serve"],
      "env": {}
    }
  }
}
```

<Warning>
确保 `command` 字段使用完整路径，如 `claude` 不在 PATH 中。
</Warning>

```bash
# 查找完整路径
which claude
```

## 专业提示

### 提示 1：选择正确的范围

| 需求 | 推荐范围 |
|------|----------|
| 个人开发服务器 | 本地 |
| 团队共享工具 | 项目 |
| 跨项目实用工具 | 用户 |

<ProTip>
合理选择范围可以避免配置混乱，同时保持必要的灵活性。
</ProTip>

### 提示 2：安全管理 MCP 访问

- **敏感数据**：使用本地范围避免泄露
- **团队工具**：使用项目范围共享
- **API 密钥**：使用环境变量而非硬编码

### 提示 3：性能优化

```bash
# 增加输出限制（对于大型查询）
MAX_MCP_OUTPUT_TOKENS=50000 claude

# 设置超时
MCP_TIMEOUT=30000 claude
```

### 提示 4：故障排除

| 问题 | 解决方案 |
|------|----------|
| 连接超时 | 增加 `MCP_TIMEOUT` |
| 输出过大 | 增加 `MAX_MCP_OUTPUT_TOKENS` |
| 认证失败 | 使用 `/mcp` 重新认证 |
| 工具不可用 | 运行 `claude mcp list` 检查状态 |

## 常见问题排查

### 问题 1：服务器无法连接

**解决方案：**
1. 检查服务器 URL 是否正确
2. 验证网络连接
3. 确认认证令牌有效
4. 查看错误消息获取详情

### 问题 2：认证失败

**解决方案：**
1. 使用 `/mcp` 重新启动认证流程
2. 清除旧认证后重试
3. 检查 OAuth 配置是否正确

### 问题 3：工具未显示

**解决方案：**
1. 运行 `claude mcp list` 确认服务器已添加
2. 重启 Claude Code 会话
3. 检查服务器是否发送了 `list_changed` 通知

### 问题 4：权限被拒绝

**解决方案：**
1. 检查范围配置
2. 确认服务器未被管理策略阻止
3. 验证 API 密钥权限

## 结论

通过 MCP 集成，Claude Code 可以连接到几乎任何外部工具和服务。通过本指南的学习，您已经掌握了：

- ✅ MCP 的基本概念和优势
- ✅ 安装和配置各种类型的 MCP 服务器
- ✅ 管理 MCP 服务器的范围和权限
- ✅ 在实际工作流中使用 MCP
- ✅ 使用 MCP 资源和提示
- ✅ OAuth 认证管理

<ProTip>
MCP 是扩展 Claude Code 能力的强大方式，合理使用可以大幅提升开发效率。
</ProTip>

<AdPlaceholder />
