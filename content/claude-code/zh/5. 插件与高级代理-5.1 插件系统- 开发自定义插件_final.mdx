---
title: "Claude Code 插件开发完全指南：从零创建自定义插件"
description: "学习如何创建自定义插件以扩展 Claude Code，包括插件清单配置、技能开发、钩子集成、MCP 服务器，以及从独立配置迁移到插件的完整流程。"
date: "2026-02-10"
tool: "Claude Code"
slug: "develop-custom-plugins"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code 插件开发完全指南

插件是扩展 Claude Code 功能的核心机制，通过创建自定义插件，您可以将技能、代理、钩子和 MCP 服务器打包成分享给团队或社区的可重用单元。插件系统支持版本控制、跨项目共享和市场分发，是构建可扩展 AI 开发环境的最佳方式。掌握插件开发将帮助您根据团队需求定制 Claude Code。

<AdPlaceholder />

## 前置条件

在开始插件开发之前，请确保满足以下条件：

- 已安装 Claude Code 1.0.33 或更高版本
- 具备基本的命令行操作经验
- 了解 JSON 和 YAML 格式
- 对技能、代理、钩子等概念有基本了解

## 插件 vs 独立配置

### 何时使用独立配置

独立配置（`.claude/` 目录）适合以下场景：为单个项目自定义 Claude Code；配置是个人使用不需要共享；在打包前进行快速实验；想要简短的技能名称如 `/hello` 或 `/review`。

### 何时使用插件

插件适合以下场景：想与团队或社区共享功能；需要在多个项目中使用相同的技能或代理；想要版本控制和轻松更新扩展；通过市场进行分发。可以接受命名空间化的技能如 `/my-plugin:hello`，命名空间可以防止插件之间的冲突。

### 对比总结

| 方法 | 技能名称 | 最适合 |
|------|----------|--------|
| 独立（`.claude/` 目录） | `/hello` | 个人工作流、项目特定自定义、快速实验 |
| 插件 | `/plugin-name:hello` | 团队共享、社区分发、版本化发布 |

建议从 `.claude/` 中的独立配置开始进行快速迭代，准备好共享时再转换为插件。

<AdPlaceholder />

## 快速开始：创建第一个插件

### 步骤 1：创建插件目录

每个插件都位于独立的目录中，包含清单文件和技能、代理或钩子。首先创建插件目录：

```bash
mkdir my-first-plugin
```

### 步骤 2：创建插件清单

位于 `.claude-plugin/plugin.json` 的清单文件定义插件的身份：名称、描述和版本。Claude Code 使用此元数据在插件管理器中显示插件。

在插件文件夹内创建 `.claude-plugin` 目录：

```bash
mkdir my-first-plugin/.claude-plugin
```

创建 `my-first-plugin/.claude-plugin/plugin.json`：

```json
{
  "name": "my-first-plugin",
  "description": "A greeting plugin to learn the basics",
  "version": "1.0.0",
  "author": {
    "name": "Your Name"
  }
}
```

清单字段说明：`name` 是唯一标识符和技能命名空间，技能以此为前缀。`description` 在浏览或安装插件时显示。`version` 使用语义版本控制跟踪发布。`author` 可选，有助于归属。

### 步骤 3：添加技能

技能位于 `skills/` 目录中，每个技能是包含 `SKILL.md` 文件的文件夹。文件夹名称成为技能名称，以插件命名空间为前缀。

创建技能目录：

```bash
mkdir -p my-first-plugin/skills/hello
```

创建 `my-first-plugin/skills/hello/SKILL.md`：

```yaml
---
description: Greet the user with a friendly message
disable-model-invocation: true
---

Greet the user warmly and ask how you can help them today.
```

### 步骤 4：测试插件

使用 `--plugin-dir` 标志运行 Claude Code 以加载插件进行测试：

```bash
claude --plugin-dir ./my-first-plugin
```

启动后尝试新命令：

```shell
/my-first-plugin:hello
```

您将看到 Claude 用问候语回应。运行 `/help` 查看命令在插件命名空间下是否列出。

<AdPlaceholder />

### 步骤 5：添加技能参数

通过 `$ARGUMENTS` 占位符捕获用户输入实现动态行为：

```yaml
---
description: Greet the user with a personalized message
---

# Hello Command

Greet the user named "$ARGUMENTS" warmly and ask how you can help them today. Make the greeting personal and encouraging.
```

重启 Claude Code 获取更改，然后使用名字运行命令：

```shell
/my-first-plugin:hello Alex
```

Claude 将按名字问候您。

<AdPlaceholder />

## 插件结构概览

### 目录结构

插件可以包含多种组件，以下是正确的目录结构：

| 目录 | 位置 | 用途 |
|------|------|------|
| `.claude-plugin/` | 插件根目录 | 包含 plugin.json 清单 |
| `commands/` | 插件根目录 | 作为 Markdown 文件的技能 |
| `agents/` | 插件根目录 | 自定义代理定义 |
| `skills/` | 插件根目录 | 具有 SKILL.md 文件的代理技能 |
| `hooks/` | 插件根目录 | hooks.json 中的事件处理程序 |
| `.mcp.json` | 插件根目录 | MCP 服务器配置 |
| `.lsp.json` | 插件根目录 | LSP 服务器配置 |

**重要警告**：不要将 `commands/`、`agents/`、`skills/` 或 `hooks/` 放在 `.claude-plugin/` 目录内。只有 `plugin.json` 应该在 `.claude-plugin/` 内，所有其他目录必须在插件根级别。

### 完整插件示例结构

```
my-plugin/
├── .claude-plugin/
│   └── plugin.json
├── commands/
│   └── greet.md
├── skills/
│   └── code-review/
│       └── SKILL.md
├── agents/
│   └── researcher.yaml
├── hooks/
│   └── hooks.json
├── .mcp.json
├── .lsp.json
└── README.md
```

<AdPlaceholder />

## 开发更复杂的插件

### 添加代理技能

插件可以包含 Agent Skills 以扩展 Claude 的功能。技能是模型调用的，Claude 根据任务上下文自动使用它们。

在插件根目录添加 `skills/` 目录，包含带有 `SKILL.md` 文件的技能文件夹：

```yaml
---
name: code-review
description: Reviews code for best practices and potential issues. Use when reviewing code, checking PRs, or analyzing code quality.
---

When reviewing code, check for:
1. Code organization and structure
2. Error handling
3. Security concerns
4. Test coverage
```

安装插件后重启 Claude Code 以加载技能。

### 添加 LSP 服务器

对于 TypeScript、Python 和 Rust 等常见语言，请从官方市场安装预构建的 LSP 插件。仅当需要支持没有官方插件的语言时，才创建自定义 LSP 插件。

通过向插件添加 `.lsp.json` 文件创建 LSP 插件：

```json
{
  "go": {
    "command": "gopls",
    "args": ["serve"],
    "extensionToLanguage": {
      ".go": "go"
    }
  }
}
```

安装插件的用户必须在其机器上安装语言服务器二进制文件。

### 添加 MCP 服务器

MCP（Model Context Protocol）服务器允许 Claude 与外部工具和数据源连接。插件可以通过 `.mcp.json` 文件配置 MCP 服务器：

```json
{
  "servers": {
    "github": {
      "command": "npx",
      "args": ["-y", "@anthropic-ai/github-mcp-server"]
    }
  }
}
```

### 添加钩子

钩子允许插件在工具事件发生时自动执行自定义逻辑。在 `hooks/` 目录中创建 `hooks.json` 文件：

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | xargs npm run lint:fix"
          }
        ]
      }
    ]
  }
}
```

<AdPlaceholder />

## 在本地测试插件

### 使用 --plugin-dir 测试

使用 `--plugin-dir` 标志在开发期间测试插件，这会直接加载插件无需安装：

```bash
claude --plugin-dir ./my-plugin
```

对插件进行更改时重启 Claude Code 以获取更新。测试所有组件：使用 `/command-name` 尝试命令，检查代理是否出现在 `/agents` 中，验证钩子是否按预期工作。

### 加载多个插件

可以通过多次指定标志来一次加载多个插件：

```bash
claude --plugin-dir ./plugin-one --plugin-dir ./plugin-two
```

### 调试常见问题

如果插件不按预期工作，请按以下步骤排查：

1. **检查结构**：确保目录在插件根目录，不是在 `.claude-plugin/` 内
2. **单独测试组件**：分别检查每个命令、代理和钩子
3. **使用验证工具**：运行 `claude plugin validate ./my-plugin` 检查配置

<AdPlaceholder />

## 将现有配置转换为插件

如果已经在 `.claude/` 目录中有技能或钩子，可以将它们转换为插件便于共享和分发。

### 迁移步骤

**第一步：创建插件结构**

```bash
mkdir -p my-plugin/.claude-plugin
```

创建 `my-plugin/.claude-plugin/plugin.json`：

```json
{
  "name": "my-plugin",
  "description": "Migrated from standalone configuration",
  "version": "1.0.0"
}
```

**第二步：复制现有文件**

```bash
# 复制命令
cp -r .claude/commands my-plugin/

# 复制代理
cp -r .claude/agents my-plugin/

# 复制技能
cp -r .claude/skills my-plugin/
```

**第三步：迁移钩子**

如果设置中有钩子，创建 hooks 目录并添加 `hooks.json`：

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "matcher": "Write|Edit",
        "hooks": [
          {
            "type": "command",
            "command": "jq -r '.tool_input.file_path' | xargs npm run lint:fix"
          }
        ]
      }
    ]
  }
}
```

**第四步：测试迁移的插件**

```bash
claude --plugin-dir ./my-plugin
```

测试每个组件确保一切正常。

### 迁移变化对比

| 独立（`.claude/`） | 插件 |
|-------------------|------|
| 仅在一个项目中可用 | 可以通过市场共享 |
| `.claude/commands/` 中的文件 | `plugin-name/commands/` 中的文件 |
| `settings.json` 中的钩子 | `hooks/hooks.json` 中的钩子 |
| 必须手动复制以共享 | 使用 `/plugin install` 安装 |

迁移后可以从 `.claude/` 中删除原始文件避免重复，插件版本将优先。

<AdPlaceholder />

## 共享与分发插件

### 准备发布

当插件准备好共享时，需要完成以下准备工作：

1. **添加文档**：包含 `README.md` 文件，包含安装和使用说明
2. **版本控制**：在 `plugin.json` 中使用语义版本控制
3. **创建市场**：通过插件市场进行分发
4. **团队测试**：在更广泛分发前让团队成员测试

### README 模板

良好的 README 应包含：插件名称和描述、功能列表、安装步骤、使用示例、配置选项、已知问题和支持渠道。

### 版本管理

使用语义版本控制（语义化版本号）：主版本号表示不兼容的 API 更改，次版本号表示向后兼容的功能新增，修订号表示向后兼容的问题修复。

<AdPlaceholder />

## 故障排除

### 常见问题

**命令无法识别**：确保使用 `--plugin-dir` 标志加载插件，检查 `/help` 中是否列出。

**技能未加载**：重启 Claude Code 确保插件重新加载，检查 `SKILL.md` 格式是否正确。

**钩子不触发**：验证 `hooks.json` 语法，检查匹配器是否正确配置。

**插件无法加载**：检查目录结构是否符合要求，清除缓存后重试。

### 调试工具

Claude Code 提供了多个调试命令：

```bash
# 验证插件配置
claude plugin validate ./my-plugin

# 列出已加载的插件
claude plugin list

# 检查插件依赖
claude plugin deps ./my-plugin
```

## 总结

插件系统为 Claude Code 提供了强大的扩展能力。从简单的问候插件开始，逐步添加技能、钩子和 MCP 服务器集成，最终创建可以与团队共享的完整解决方案。记住从独立配置开始实验，验证功能后再转换为插件进行分发。善用调试工具和版本控制，确保插件的质量和可维护性。

<AdPlaceholder />
