---
title: "Claude Code 插件技术规范完全参考：架构、CLI 命令与组件详解"
description: "Claude Code 插件系统的完整技术参考，包括插件清单架构、组件规范、CLI 命令、调试工具，以及缓存与文件解析机制的深度解析。"
date: "2026-02-10"
tool: "Claude Code"
slug: "plugin-technical-specification"
---

import AdPlaceholder from '@/components/AdPlaceholder'

# Claude Code 插件技术规范完全参考

本参考文档提供了 Claude Code 插件系统的完整技术规范，涵盖插件清单架构、组件配置、CLI 命令、开发工具等核心内容。无论您是开发插件、调试问题还是进行高级集成，这份详尽的参考都将为您提供必要的规范说明。掌握这些技术细节将帮助您构建高质量、可维护的插件系统。

<AdPlaceholder />

## 前置条件

本参考手册面向有一定插件开发经验的读者，建议您已具备以下知识：

- 熟悉 JSON 和 YAML 格式规范
- 了解插件的基本结构和创建流程
- 具备命令行操作和脚本编写经验
- 理解 MCP 和 LSP 协议的基本概念

## 插件组件完整参考

### Skills 组件

插件通过 Skills 向 Claude Code 添加可调用功能，创建 `/name` 快捷方式供用户或 Claude 自动调用。

**文件位置**：插件根目录中的 `skills/` 或 `commands/` 目录

**文件格式**：Skills 是包含 `SKILL.md` 文件的目录；commands 是简单的 markdown 文件

**目录结构**：
```
skills/
├── pdf-processor/
│   ├── SKILL.md
│   ├── reference.md (可选)
│   └── scripts/ (可选)
└── code-reviewer/
    └── SKILL.md
```

**集成行为**：安装插件时自动发现 Skills 和 commands；Claude 可以根据任务上下文自动调用；Skills 可以在 SKILL.md 旁边包含支持文件。

### Agents 组件

插件可以为特定任务提供专门的 subagents，Claude 可以在适当时自动调用。

**文件位置**：插件根目录中的 `agents/` 目录

**文件格式**：描述代理功能的 Markdown 文件

**配置格式**：
```markdown
---
name: agent-name
description: 该代理的专长以及 Claude 应何时调用它
---

详细的系统提示，描述代理的角色、专业知识和行为。
```

**集成点**：Agents 出现在 `/agents` 界面中；Claude 可以根据任务上下文自动调用；Agents 可以由用户手动调用；插件 agents 与内置 Claude agents 一起工作。

### Hooks 组件

插件可以提供事件处理程序，自动响应 Claude Code 事件。

**文件位置**：插件根目录中的 `hooks/hooks.json`，或在 plugin.json 中内联

**可用事件**：`PreToolUse` 在 Claude 使用任何工具之前；`PostToolUse` 在 Claude 成功使用任何工具之后；`PostToolUseFailure` 在工具执行失败之后；`PermissionRequest` 在显示权限对话框时；`UserPromptSubmit` 在用户提交提示时；`Notification` 在 Claude Code 发送通知时；`Stop` 在 Claude 尝试停止时；`SubagentStart` 在启动 subagent 时；`SubagentStop` 在 subagent 尝试停止时；`SessionStart` 在会话开始时；`SessionEnd` 在会话结束时；`PreCompact` 在压缩对话历史之前。

**Hook 类型**：`command` 执行 shell 命令或脚本；`prompt` 使用 LLM 评估提示；`agent` 运行具有工具的代理验证器。

### MCP Servers 组件

插件可以捆绑 Model Context Protocol 服务器，将 Claude Code 与外部工具和服务连接。

**文件位置**：插件根目录中的 `.mcp.json`，或在 plugin.json 中内联

**配置格式**：
```json
{
  "mcpServers": {
    "plugin-database": {
      "command": "${CLAUDE_PLUGIN_ROOT}/servers/db-server",
      "args": ["--config", "${CLAUDE_PLUGIN_ROOT}/config.json"],
      "env": {
        "DB_PATH": "${CLAUDE_PLUGIN_ROOT}/data"
      }
    }
  }
}
```

**集成行为**：启用插件时 MCP 服务器自动启动；服务器在 Claude 的工具包中显示为标准 MCP 工具；服务器功能与现有工具无缝集成。

### LSP Servers 组件

插件可以提供 Language Server Protocol 服务器，为 Claude 提供实时代码智能。

**配置格式**：
```json
{
  "go": {
    "command": "gopls",
    "args": ["serve"],
    "extensionToLanguage": {
      ".go": "go"
    }
  }
}
```

**必需字段**：`command` 指定要执行的 LSP 二进制文件；`extensionToLanguage` 将文件扩展名映射到语言标识符。

**可选字段**：`args` 命令行参数；`transport` 通信传输方式；`env` 环境变量；`initializationOptions` 初始化选项；`settings` 工作区设置；`workspaceFolder` 工作区文件夹路径；`startupTimeout` 启动超时时间；`shutdownTimeout` 关闭超时时间；`restartOnCrash` 自动重启设置；`maxRestarts` 最大重启次数。

<AdPlaceholder />

## 插件清单完整架构

`.claude-plugin/plugin.json` 文件定义了插件的元数据和配置。以下是完整架构：

### 必需字段

如果包含清单，`name` 是唯一必需的字段：

| 字段 | 类型 | 描述 | 示例 |
|------|------|------|------|
| `name` | string | 唯一标识符（kebab-case） | `"deployment-tools"` |

### 元数据字段

| 字段 | 类型 | 描述 |
|------|------|------|
| `version` | string | 语义版本号 |
| `description` | string | 插件目的的简要说明 |
| `author` | object | 作者信息 |
| `homepage` | string | 文档 URL |
| `repository` | string | 源代码 URL |
| `license` | string | 许可证标识符 |
| `keywords` | array | 发现标签 |

### 组件路径字段

| 字段 | 类型 | 描述 |
|------|------|------|
| `commands` | string\|array | 命令文件或目录 |
| `agents` | string\|array | agent 文件或目录 |
| `skills` | string\|array | skill 目录 |
| `hooks` | string\|array\|object | Hook 配置 |
| `mcpServers` | string\|array\|object | MCP 配置 |
| `outputStyles` | string\|array | 输出样式 |
| `lspServers` | string\|array\|object | LSP 配置 |

### 路径行为规则

自定义路径补充默认目录，不替换默认目录。如果 `commands/` 存在，除了自定义命令路径外也会被加载。所有路径必须相对于插件根目录，并以 `./` 开头。

<AdPlaceholder />

## 插件安装范围

安装插件时选择的范围决定了插件的可用位置和权限：

| 范围 | 设置文件 | 用例 |
|------|----------|------|
| `user` | `~/.claude/settings.json` | 在所有项目中可用的个人插件 |
| `project` | `.claude/settings.json` | 通过版本控制共享的团队插件 |
| `local` | `.claude/settings.local.json` | 项目特定的插件（gitignored） |
| `managed` | `managed-settings.json` | 托管插件（只读） |

<AdPlaceholder />

## CLI 命令完整参考

### plugin install

从可用市场安装插件：

```bash
claude plugin install <plugin> [options]
```

**选项**：
- `-s, --scope <scope>`：安装范围，默认为 `user`
- `-h, --help`：显示帮助

### plugin uninstall

删除已安装的插件：

```bash
claude plugin uninstall <plugin> [options]
```

**别名**：`remove`、`rm`

### plugin enable

启用禁用的插件：

```bash
claude plugin enable <plugin> [options]
```

### plugin disable

禁用插件而不卸载：

```bash
claude plugin disable <plugin> [options]
```

### plugin update

将插件更新到最新版本：

```bash
claude plugin update <plugin> [options]
```

<AdPlaceholder />

## 插件缓存与文件解析

### 缓存工作原理

出于安全和验证目的，Claude Code 将插件复制到缓存目录，而不是就地使用。安装插件时，Claude Code 会定位市场和市场内插件的 `source` 字段。

源类型包括：相对路径（递归复制到缓存）、npm 包、pip 包、git URL、GitHub 简写（owner/repo）。

### 路径遍历限制

插件无法引用其复制目录结构之外的文件。遍历插件根目录之外的路径在安装后将不起作用，因为外部文件不会被复制到缓存。

### 使用外部依赖

**选项 1：使用符号链接**

在插件目录中创建指向外部文件的符号链接，在复制过程中会遵守符号链接：

```bash
ln -s /path/to/shared-utils ./shared-utils
```

**选项 2：重组市场**

将插件路径设置为包含所有必需文件的父目录，直接在市场条目中提供插件清单。

<AdPlaceholder />

## 调试与故障排除

### 调试命令

使用 `claude --debug` 查看插件加载详情，显示正在加载的插件、清单错误、命令和 hook 注册、MCP 服务器初始化等信息。

### 常见问题与解决方案

| 问题 | 原因 | 解决方案 |
|------|------|----------|
| 插件未加载 | 无效的 plugin.json | 使用 `claude plugin validate` 验证 |
| 命令未出现 | 目录结构错误 | 确保 commands/ 在根目录 |
| Hooks 未触发 | 脚本不可执行 | 运行 `chmod +x script.sh` |
| MCP 服务器失败 | 缺少 `${CLAUDE_PLUGIN_ROOT}` | 对所有插件路径使用变量 |
| LSP 未找到 | 未安装语言服务器 | 安装二进制文件 |

### Hook 故障排除

**Hook 脚本未执行**：检查脚本是否可执行、验证 shebang 行、检查路径是否使用 `${CLAUDE_PLUGIN_ROOT}`、手动测试脚本。

**Hook 未在预期事件触发**：验证事件名称（区分大小写）、检查匹配器模式、确认 hook 类型有效。

### MCP 服务器故障排除

**服务器未启动**：检查命令是否存在、验证路径变量、检查 MCP 日志、手动测试服务器。

**服务器工具未出现**：确保配置正确、验证服务器实现、检查连接超时。

<AdPlaceholder />

## 版本管理

### 版本格式

遵循语义版本控制：`MAJOR.MINOR.PATCH`

- **MAJOR**：破坏性更改（不兼容的 API 更改）
- **MINOR**：新功能（向后兼容的添加）
- **PATCH**：错误修复（向后兼容的修复）

### 最佳实践

从 `1.0.0` 开始第一个稳定版本；在分发更改前更新版本；在 CHANGELOG.md 中记录更改；使用预发布版本如 `2.0.0-beta.1` 进行测试。

## 目录结构参考

### 标准插件布局

```
enterprise-plugin/
├── .claude-plugin/
│   └── plugin.json           # 插件清单
├── commands/
│   ├── status.md
│   └── logs.md
├── agents/
│   ├── security-reviewer.md
│   └── performance-tester.md
├── skills/
│   └── code-reviewer/
│       └── SKILL.md
├── hooks/
│   └── hooks.json
├── .mcp.json
├── .lsp.json
├── scripts/
├── LICENSE
└── CHANGELOG.md
```

### 文件位置参考

| 组件 | 默认位置 | 用途 |
|------|----------|------|
| 清单 | `.claude-plugin/plugin.json` | 元数据和配置 |
| Commands | `commands/` | Skill Markdown 文件 |
| Agents | `agents/` | Subagent Markdown 文件 |
| Skills | `skills/` | 具有 SKILL.md 结构的 Skills |
| Hooks | `hooks/hooks.json` | Hook 配置 |
| MCP 服务器 | `.mcp.json` | MCP 服务器定义 |
| LSP 服务器 | `.lsp.json` | 语言服务器配置 |

<AdPlaceholder />

## 环境变量

**`${CLAUDE_PLUGIN_ROOT}`**：包含插件目录的绝对路径，在 hooks、MCP 服务器和脚本中使用此变量确保路径正确：

```json
{
  "hooks": {
    "PostToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "${CLAUDE_PLUGIN_ROOT}/scripts/process.sh"
          }
        ]
      }
    ]
  }
}
```

## 总结

本技术参考涵盖了 Claude Code 插件系统的所有核心规范。正确理解和应用这些规范对于开发高质量插件至关重要。建议在实际开发中遇到问题时查阅对应章节，遵循版本管理最佳实践，确保插件的稳定性和可维护性。

<AdPlaceholder />
