---
title: "Sandbox mechanism"
description: "Learn about Codex's security mechanisms, including sandbox mode, approval policies, and network access control"
tool: "codex"
slug: "security"
locale: "en"
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

# Security

Codex helps protect your code and data and reduce the risk of abuse.

By default, the agent runs with network access turned off. Locally, Codex uses an operating system-enforced sandbox that limits what it can touch (usually to the current workspace), plus an approval policy that controls when it must stop and ask you.

<AdPlaceholder />

## Sandbox and Approval

Codex security controls come from two layers that work together:

- **Sandbox Mode**: What the Codex can technically do when executing commands generated by the model (e.g. where it can write, whether it has network access).
- **Approval Policy**: How long Codex must ask you before performing an action (e.g. leaving the sandbox, using the network, or running a command that is not within the trusted set).

Codex uses different sandbox modes depending on where it is run:

- **Codex Cloud**: Runs in an isolated OpenAI managed container, preventing access to your host system or extraneous data. You can intentionally extend access (for example, install dependencies or allow specific domains). Network access is always enabled during the setup phase, before the agent can access your code.
- **Codex CLI/IDE Extension**: OS level mechanism to enforce sandbox policies. Default values ​​include no network access and write permissions restricted to the active workspace. You can configure sandboxes, approval policies, and network settings based on your risk tolerance.

In the `Auto` preset (e.g. `--full-auto`), Codex can automatically read files, edit and run commands in the working directory.

Codex will ask for permission to edit files outside the workspace or run commands that require network access. If you want to chat or plan without making changes, use the `/permissions` command to switch to `read-only` mode.

Codex can also seek approval for application (connector) tool calls that advertise side effects, even if the action is not a shell command or file change.

## Network accessFor Codex Cloud, see [代理互联网访问](https://developers.openai.com/codex/cloud/internet-access) to enable full internet access or domain allowlist.

For Codex apps, CLI or IDE extensions, `workspace-write` sandbox mode keeps network access turned off by default unless you enable it in the configuration:
```tom
[sandbox_workspace_write]
network_access = true
```You
 can also control [网页搜索工具](https://platform.openai.com/docs/guides/tools-web-search) without granting full network access to the generated commands. Codex defaults to using the web search cache to access results. The cache is an index of web results maintained by OpenAI, so cache mode returns pre-indexed results rather than fetching live pages. This reduces prompt injection exposure from arbitrary live content, but you should still treat web results as untrusted. If you use `--yolo` or another [完全访问沙箱设置](#常见沙箱和批准组合), web searches default to live results. Use `--search` or set `web_search = "live"` to allow live browsing, or set it to `"disabled"` to turn off the tool:
```tom
web_search = "cached"  # 默认
# web_search = "disabled"
# web_search = "live"  # 与 --search 相同
```
<Callout type="warning">
Be careful when enabling network access or web searches in Codex. Tip injection can cause an agent to obtain and follow untrusted instructions.
</Callout>

## Default values and recommendations

- On startup, Codex detects whether the folder is version controlled and recommends:
  - Version Control Folder: `Auto` (workspace write + approve on request)
  - Non-versioned folder: `只读`
- Depending on your setup, the Codex may also start as `read-only` until you explicitly trust the working directory (for example, via the onboarding prompt or `/permissions`).
- The workspace includes the current directory and a temporary directory (such as `/tmp`). Use the `/status` command to view which directories are in the workspace.
- To accept the default values, run `codex`.
- You can set these explicitly:
  - `codex --sandbox workspace-write --ask-for-approval on-request`
  - `codex --sandbox read-only --ask-for-approval on-request`

### Run without approval prompt

You can disable the approval prompt using `--ask-for-approval never` or `-a never` (shorthand).

This option applies to all `--sandbox` modes, so you still control how autonomous the Codex is. Codex does its best within the constraints you set.

If you need Codex to read files, edit, and run commands with network access without an approval prompt, use the `--sandbox danger-full-access` (or `--dangerously-bypass-approvals-and-sandbox` flag). Please use caution before doing this.

### Common sandbox and approval combinations| Intent | Logo | Effect |
| ---- | ---- | ---- |
| Automatic (default) | _No flag required_ or `--full-auto` | Codex can read files, edit, and run commands in the workspace. Codex requires approval to edit outside of the workspace or access the network. |
| Safe read-only browsing | `--sandbox read-only --ask-for-approval on-request` | Codex can read files and answer questions. Codex requires approval to edit, run commands, or access the network. |
| Read-only non-interactive (CI) | `--sandbox read-only --ask-for-approval never` | Codex can only read files; never ask for approval. |
| Auto-edit but requires approval to run untrusted commands | `--sandbox workspace-write --ask-for-approval untrusted` | Codex can read and edit files, but requires approval to run untrusted commands. |
| DANGEROUS FULL ACCESS | `--dangerously-bypass-approvals-and-sandbox` (alias: `--yolo`) | No sandbox; no approval (not recommended) |

`--full-auto` is a convenience alias for `--sandbox workspace-write --ask-for-approval on-request`.

With `--ask-for-approval untrusted`, Codex automatically runs only read operations that are known to be safe. Commands that can change state or trigger external execution paths (for example, destructive Git operations or Git output/config override flags) require approval.

#### Configuration in config.toml
```tom
# 始终询问批准模式
approval_policy = "untrusted"
sandbox_mode    = "read-only"

# 可选：在工作区写入模式下允许网络
[sandbox_workspace_write]
network_access = true
```You
 can also save presets as profiles and select them using `codex --profile <name>`:
```tom
[profiles.full_auto]
approval_policy = "on-request"
sandbox_mode    = "workspace-write"

[profiles.readonly_quiet]
approval_policy = "never"
sandbox_mode    = "read-only"
```
### Test the sandbox locally

To see what happens when a command is run under the Codex sandbox, use these Codex CLI commands:
```bas
# macOS
codex sandbox macos [--full-auto] [--log-denials] [COMMAND]...
# Linux
codex sandbox linux [--full-auto] [COMMAND]...
```The
 `sandbox` command is also available as `codex debug`, and the platform helpers have aliases (such as `codex sandbox seatbelt` and `codex sandbox landlock`).

## Operating system level sandbox

Codex enforces sandboxing differently depending on your operating system:

- **macOS** Use the Seatbelt policy and run the command with `sandbox-exec` using the profile corresponding to the `--sandbox` mode of your choice (`-p`).
- **Linux** uses `Landlock` plus `seccomp` by default. You can select an alternative Linux sandbox pipeline using `features.use_linux_sandbox_bwrap = true` (or `-c use_linux_sandbox_bwrap=true`).
- **Windows** is implemented using a Linux sandbox when running in [Windows Subsystem for Linux (WSL)](https://developers.openai.com/codex/windows#windows-subsystem-for-linux). When running on native Windows, you can enable the [实验性沙箱](https://developers.openai.com/codex/windows#windows-experimental-sandbox) implementation.

If you use the Codex IDE extension on Windows, it supports WSL directly. Set the following in your VS Code settings to always keep the proxy in WSL when available:
```jso
{
  "chatgpt.runCodexInWindowsSubsystemForLinux": true
}
```
This
 ensures that IDE extensions inherit the Linux sandbox semantics of commands, approvals, and file system access, even if the host operating system is Windows. Learn more in [Windows 设置指南](https://developers.openai.com/codex/windows).

<Callout type="note">
The native Windows sandbox is experimental and has important limitations. For example, it cannot prevent writing in a directory where the `Everyone` SID already has write permission (for example, a world-writable folder). See [Windows 设置指南](https://developers.openai.com/codex/windows#windows-experimental-sandbox) for details and mitigation steps.
</Callout>

When you run Linux in a containerized environment such as Docker, the sandbox may not work if the host or container configuration does not support the required `Landlock` and `seccomp` features.

In this case, configure your Docker container to provide the required isolation, then run `codex` inside the container using the `--sandbox danger-full-access` (or `--dangerously-bypass-approvals-and-sandbox` flag).

## Version control

Codex works best in version control workflows:

- Work on feature branches and keep `git status` clean before delegating. This makes Codex patches easier to isolate and roll back.
- Prefer using patch-based workflows (e.g. `git diff`/`git apply`) instead of directly editing tracked files. Commit often so you can roll back in small increments.
- Treat Codex suggestions like any other PR: run target validation, review diffs, and record decisions in commit messages for auditing purposes.

## Monitoring and TelemetryCodex supports opt-in monitoring via OpenTelemetry (OTel) to help teams audit usage, investigate issues, and meet compliance requirements without compromising local security defaults. Telemetry is off by default; enable it explicitly in your configuration.

### Overview

- Codex turns off OTel exports by default to keep local runs self-contained.
- When enabled, Codex emits structured log events covering conversations, API requests, SSE/WebSocket flow activity, user prompts (edited by default), tool approval decisions, and tool results.
- Codex tags export events with `service.name` (initiator), CLI version, and environment tags to separate development/staging/production traffic.

### Enable OTel (opt-in)

Add a `[otel]` block (usually `~/.codex/config.toml`) to the Codex configuration, select the exporter and whether to log the prompt word text.
```tom
[otel]
environment = "staging"   # dev | staging | prod
exporter = "none"          # none | otlp-http | otlp-grpc
log_user_prompt = false     # 除非策略允许，否则编辑提示词文本
```-
 `exporter = "none"` Keeps instrumentation active but does not send data anywhere.
- To send to your own collector, choose one:
```tom
[otel]
exporter = { otlp-http = {
  endpoint = "https://otel.example.com/v1/logs",
  protocol = "binary",
  headers = { "x-otlp-api-key" = "${OTLP_TOKEN}" }
}}
```

```tom
[otel]
exporter = { otlp-grpc = {
  endpoint = "https://otel.example.com:4317",
  headers = { "x-otlp-meta" = "abc123" }
}}
```Codex
 batches events and exports them on shutdown. Codex only exports telemetry produced by its OTel module.

### Event Category

Representative event types include:

- `codex.conversation_starts` (model, inference settings, sandbox/approval policy)
- `codex.api_request` (attempt, status/success, duration and error details)
- `codex.sse_event` (stream event type, success/failure, duration, plus token count on `response.completed`)
- `codex.websocket_request` and `codex.websocket_event` (request duration plus per message type/success/error)
- `codex.user_prompt` (length; content edited unless explicitly enabled)
- `codex.tool_decision` (Approve/Deny, Source: Configuration & User)
- `codex.tool_result` (duration, success, output fragment)

Associated OTel metrics (counter plus duration histogram pairs) include `codex.api_request`, `codex.sse_event`, `codex.websocket.request`, `codex.websocket.event`, and `codex.tool.call` (with corresponding `.duration_ms` instruments).

For complete event catalog and configuration reference, see [GitHub 上的 Codex 配置文档](https://github.com/openai/codex/blob/main/docs/config.md#otel).

### Security and Privacy Guidance- Keep `log_user_prompt = false` unless the policy explicitly allows storage of prompt word content. Prompt words may contain source code and sensitive data.
- Route telemetry only to collectors you control; apply retention limits and access controls that meet your compliance requirements.
- Treat tool parameters and outputs as sensitive. Edit in the collector or SIEM when possible.
- If you don't want Codex to save session records to files under `CODEX_HOME`, check your local data retention settings (e.g. `history.persistence` / `history.max_bytes`). See [高级配置](https://developers.openai.com/codex/config-advanced#history-persistence) and [配置参考](https://developers.openai.com/codex/config-reference).
- OTel exports cannot reach your collector if you run the CLI with `--yolo` or network access is turned off. To export, allow network access for the OTel endpoint in `workspace-write` mode, or export from Codex Cloud and include the collector domain in the allow list.
- Regularly review events for approval/sandbox changes and unexpected tool execution.

OTel is optional and is intended to supplement, not replace, the sandbox and approval protections described above.

## Hosting configuration

Enterprise administrators can control local Codex behavior in two ways:

- **Requirement**: Administrator enforces constraints, which cannot be overridden by users.
- **Managed Default**: The starting value applied on startup. Users can still change settings during a session; Codex will reapply managed defaults the next time it starts.

### Administrator mandatory requirements (requirements.toml)Requirements constrain security-sensitive settings (approval policies, sandbox mode, web search mode, and optional MCP server you can enable). If the user explicitly selects a forbidden value (via `config.toml`, CLI flag, configuration file, or in-session UI), the Codex rejects the change. If a value is not set explicitly and the default value conflicts with the requirements, Codex will fall back to the default value that meets the requirements. If you configure a `mcp_servers` approval list, Codex only enables the MCP server if its name and identity match the approval entry; otherwise, Codex shuts it down.

#### Location

- Linux/macOS (Unix): `/etc/codex/requirements.toml`
- macOS MDM: Preference domain `com.openai.codex`, key `requirements_toml_base64`

#### Cloud Requirements (Enterprise and Education Edition)

Codex can also obtain administrator enforcement requirements from the Codex service when you log in to Enterprise and Education plans using ChatGPT. This applies to all Codex interfaces including TUI, `codex exec` and `codex app-server`.

Cloud requirements are currently best-effort. If the fetch fails or times out, Codex continues without a cloud layer.

Requirements layers are in this order (higher priority wins):

- macOS hosting preferences (highest priority)
- Cloud requirements (ChatGPT Enterprise or Education Edition)
- `/etc/codex/requirements.toml`

Cloud requirements only populate unset requirement fields, so the higher-priority hosting tier still wins when both specify the same constraints.

For backward compatibility, the Codex also interprets the legacy `managed_config.toml` fields `approval_policy` and `sandbox_mode` as requirements (only that single value is allowed).

#### Example requirements.tomlThis example blocks `--ask-for-approval never` and `--sandbox danger-full-access` (including `--yolo`):
```tom
allowed_approval_policies = ["untrusted", "on-request", "on-failure"]
allowed_sandbox_modes = ["read-only", "workspace-write"]
```You
 can also constrain web search patterns:
```tom
allowed_web_search_modes = ["cached"] # "disabled" 仍然隐式允许
`
```allowed_web_search_modes
 = []` effectively only allows `"disabled"`. For example, `allowed_web_search_modes = ["cached"]` blocks live web searches even within a `danger-full-access` session.

#### Enforce command rules from requirements

Administrators can also enforce restrictive command rules from `requirements.toml` using the `[rules]` table. These rules are merged with the regular `.rules` file, and the strictest decision still wins.

Unlike `.rules`, the requirement rule must specify `decision`, and the decision must be `"prompt"` or `"forbidden"` (not `"allow"`).
```tom
[rules]
prefix_rules = [
  { pattern = [{ token = "rm" }], decision = "forbidden", justification = "Use git clean -fd instead." },
  { pattern = [{ token = "git" }, { any_of = ["push", "commit"] }], decision = "prompt", justification = "Require review before mutating history." },
]
```
To
 limit the MCP servers that Codex can enable, add the `mcp_servers` approval list. For a stdio server, matches `command`; for a streamable HTTP server, matches `url`:
```tom
[mcp_servers.docs]
identity = { command = "codex-mcp" }

[mcp_servers.remote]
identity = { url = "https://example.com/mcp" }
```If
 `mcp_servers` is present but empty, Codex disables all MCP servers.

### Managed Defaults (managed_config.toml)

Managed defaults are merged over the user's local `config.toml` and priority is applied when the Codex is started. Users can still change these settings during a session; Codex will reapply the managed defaults the next time it starts.

Make sure your managed defaults meet your needs; Codex will reject prohibited values.

#### Prioritization and tiering

The Codex assembles valid configurations in this order (top covers bottom):

- Hosting preferences (macOS MDM; highest priority)
- `managed_config.toml` (system/hosted files)
- `config.toml` (user’s baseline configuration)

CLI `--config key=value` overrides apply to baselines, but the hosting layer overrides them. This means that every run starts with managed defaults, even if you provide local flags.

Cloud requirements affect the demand tier (not the managed default). See [管理员强制需求](https://developers.openai.com/codex/security#admin-enforced-requirements-requirementstoml) for its priority.

#### Location

- Linux/macOS (Unix): `/etc/codex/managed_config.toml`
- Windows/non-Unix: `~/.codex/managed_config.toml`

If the file is missing, Codex will skip the hosting layer.

#### macOS Managed Preferences (MDM)

On macOS, administrators can push device profiles that provide a base64-encoded TOML payload:- Preference field: `com.openai.codex`
- Key:
  - `config_toml_base64` (managed default)
  - `requirements_toml_base64` (required)

Codex parses these "hosted preference" payloads into TOML and applies them with the highest priority.

#### MDM setup workflow

Codex follows standard macOS MDM payloads, so you can distribute settings using tools like Jamf Pro, Fleet, or Kandji. A lightweight deployment looks like this:

1. Build the managed payload TOML and encode it using `base64` (no wrapping).
2. Place the string into `config_toml_base64` (managed default) or `requirements_toml_base64` (requirement) under the `com.openai.codex` domain in your MDM profile.
3. Push the configuration file, then ask the user to restart the Codex and confirm that the startup configuration summary reflects the managed values.
4. When a policy is revoked or changed, the managed payload is updated; the CLI will read the refreshed preferences on next launch.

Avoid embedding secrets or highly variable dynamic values ​​in the payload. Treat managed TOML like any other MDM setup.

#### Example managed_config.toml
```tom
# 设置保守默认值
approval_policy = "on-request"
sandbox_mode    = "workspace-write"

[sandbox_workspace_write]
network_access = false             # 保持网络禁用，除非明确允许

[otel]
environment = "prod"
exporter = "otlp-http"            # 指向您的收集器
log_user_prompt = false            # 保持提示词被编辑
# 导出器详情位于导出器表下；见上文的监控和遥测
```
### Recommended guardrails

- Reserve `workspace-write` plus approval for most users; reserve full access for controlled containers.
- Keep `network_access = false` unless your security clearance allows the domain required by the collector or workflow.
- Fixed OTel settings (exporter, environment) using managed configuration, but keep `log_user_prompt = false` unless your policy explicitly allows storage of prompt word content.
- Regularly audit differences between local `config.toml` and managed policies to catch drift; the managed layer should win out over local flags and files.

<AdPlaceholder />
