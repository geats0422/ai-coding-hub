---
title: 智能体配置
tool: "opencode"
slug: agents
description: 配置和使用专用智能体 - 智能体是可以为特定任务和工作流配置的专用 AI 助手。
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

<AdPlaceholder />

智能体是可以为特定任务和工作流配置的专用 AI 助手。它们允许你创建具有自定义提示、模型和工具访问权限的专注工具。

<Callout type="tip">
使用 `plan` 智能体分析代码并审查建议，而不进行任何代码更改。
</Callout>

你可以在会话期间切换智能体，或使用 `@` 提及来调用它们。

## 类型 (Types)

OpenCode 中有两种类型的智能体；主智能体 (primary agents) 和子智能体 (subagents)。

### 主智能体 (Primary agents)

主智能体是你直接与之交互的主要助手。你可以使用 `Tab` 键或你配置的 `switch_agent` 快捷键在它们之间循环。这些智能体处理你的主要对话。工具访问权限通过权限配置——例如，Build 启用了所有工具，而 Plan 受到限制。

<Callout type="tip">
你可以使用 `Tab` 键在会话期间在主智能体之间切换。
</Callout>

OpenCode 带有两个内置的主智能体，Build 和 Plan。我们将在下面查看这些。

### 子智能体 (Subagents)

子智能体是主智能体可以为特定任务调用的专用助手。你也可以通过在消息中 `@` 提及它们来手动调用它们。

OpenCode 带有两个内置的子智能体，General 和 Explore。我们将在下面查看这些。

## 内置 (Built-in)

OpenCode 带有两个内置的主智能体和两个内置的子智能体。

### 使用 build (Use build)

模式: `primary`

Build 是默认的主智能体，启用了所有工具。这是开发工作的标准智能体，你需要完全访问文件操作和系统命令。

### 使用 plan (Use plan)

模式: `primary`

专为规划和分析设计的受限智能体。我们使用权限系统给你更多控制权并防止意外更改。默认情况下，以下所有项都设置为 `ask`：

- 文件编辑: 所有写入、补丁和编辑
- bash: 所有 bash 命令

当你希望 LLM 分析代码、建议更改或创建计划而不对代码库进行任何实际修改时，此智能体非常有用。

### 使用 general (Use general)

模式: `subagent`

用于研究复杂问题和执行多步任务的通用智能体。拥有完整的工具访问权限 (除了 todo)，因此它可以在需要时进行文件更改。使用它并行运行多个工作单元。

### 使用 explore (Use explore)

模式: `subagent`

用于探索代码库的快速、只读智能体。无法修改文件。当你需要通过模式快速查找文件、搜索代码中的关键字或回答有关代码库的问题时，请使用此智能体。

### 使用 compaction (Use compaction)

模式: `primary`

隐藏的系统智能体，将长上下文压缩为较小的摘要。它在需要时自动运行，并且在 UI 中不可选。

### 使用 title (Use title)

模式: `primary`

隐藏的系统智能体，生成简短的会话标题。它自动运行，并且在 UI 中不可选。

### 使用 summary (Use summary)

模式: `primary`

隐藏的系统智能体，创建会话摘要。它自动运行，并且在 UI 中不可选。

## 用法 (Usage)

对于主智能体，在会话期间使用 `Tab` 键在它们之间循环。你也可以使用你配置的 `switch_agent` 快捷键。

子智能体可以被调用：

- 由主智能体根据其描述自动调用以执行专门任务。
- 通过在消息中手动 `@` 提及子智能体。例如。

```bash
@general help me search for this function
```

会话之间的导航：当子智能体创建自己的子会话时，你可以使用以下方式在父会话和所有子会话之间导航：

- `<Leader>+Right` (或你配置的 `session_child_cycle` 快捷键) 向前循环：父 -> 子1 -> 子2 -> ... -> 父
- `<Leader>+Left` (或你配置的 `session_child_cycle_reverse` 快捷键) 向后循环：父 &lt;- 子1 &lt;- 子2 &lt;- ... &lt;- 父

这允许你在主对话和专门的子智能体工作之间无缝切换。

## 配置 (Configure)

你可以自定义内置智能体或通过配置创建自己的智能体。智能体可以通过两种方式配置：

### JSON

在你的 `opencode.json` 配置文件中配置智能体：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "build": {
      "mode": "primary",
      "model": "anthropic/claude-sonnet-4-20250514",
      "prompt": "{file:./prompts/build.txt}",
      "tools": {
        "write": true,
        "edit": true,
        "bash": true
      }
    },
    "plan": {
      "mode": "primary",
      "model": "anthropic/claude-haiku-4-20250514",
      "tools": {
        "write": false,
        "edit": false,
        "bash": false
      }
    },
    "code-reviewer": {
      "description": "Reviews code for best practices and potential issues",
      "mode": "subagent",
      "model": "anthropic/claude-sonnet-4-20250514",
      "prompt": "You are a code reviewer. Focus on security, performance, and maintainability.",
      "tools": {
        "write": false,
        "edit": false
      }
    }
  }
}
```

### Markdown

你也可以使用 markdown 文件定义智能体。将它们放在：

- 全局: `~/.config/opencode/agents/`
- 每个项目: `.opencode/agents/`

```yaml
---
description: Reviews code for quality and best practices
mode: subagent
model: anthropic/claude-sonnet-4-20250514
temperature: 0.1
tools:
  write: false
  edit: false
  bash: false
---

You are in code review mode. Focus on:

- Code quality and best practices
- Potential bugs and edge cases
- Performance implications
- Security considerations

Provide constructive feedback without making direct changes.
```

markdown 文件名成为智能体名称。例如，`review.md` 创建一个 `review` 智能体。

## 选项 (Options)

让我们详细看看这些配置选项。

### 描述 (Description)

使用 `description` 选项提供关于智能体做什么以及何时使用它的简要描述。

```json
{
  "agent": {
    "review": {
      "description": "Reviews code for best practices and potential issues"
    }
  }
}
```

这是一个必需的配置选项。

### 温度 (Temperature)

使用 `temperature` 配置控制 LLM 响应的随机性和创造力。

较低的值使响应更加专注和确定，而较高的值增加创造力和可变性。

```json
{
  "agent": {
    "plan": {
      "temperature": 0.1
    },
    "creative": {
      "temperature": 0.8
    }
  }
}
```

温度值通常在 0.0 到 1.0 之间：

- 0.0-0.2: 非常专注和确定的响应，非常适合代码分析和规划
- 0.3-0.5: 平衡的响应，具有一定的创造力，适合一般开发任务
- 0.6-1.0: 更具创造力和多样化的响应，适用于头脑风暴和探索

```json
{
  "agent": {
    "analyze": {
      "temperature": 0.1,
      "prompt": "{file:./prompts/analysis.txt}"
    },
    "build": {
      "temperature": 0.3
    },
    "brainstorm": {
      "temperature": 0.7,
      "prompt": "{file:./prompts/creative.txt}"
    }
  }
}
```

如果未指定温度，OpenCode 使用特定于模型的默认值；通常大多数模型为 0，Qwen 模型为 0.55。

### 最大步骤 (Max steps)

使用 `steps` 控制智能体在被迫仅以文本响应之前可以执行的最大智能体迭代次数。这允许希望控制成本的用户对智能体操作设置限制。

如果未设置此项，智能体将继续迭代，直到模型选择停止或用户中断会话。

```json
{
  "agent": {
    "quick-thinker": {
      "description": "Fast reasoning with limited iterations",
      "prompt": "You are a quick thinker. Solve problems with minimal steps.",
      "steps": 5
    }
  }
}
```

当达到限制时，智能体将收到一个特殊的系统提示，指示其以工作总结和建议的剩余任务进行响应。

<Callout type="warning">
旧版 `maxSteps` 字段已弃用。请改用 `steps`。
</Callout>

### 禁用 (Disable)

设置为 `true` 以禁用智能体。

```json
{
  "agent": {
    "review": {
      "disable": true
    }
  }
}
```

### 提示 (Prompt)

使用 `prompt` 配置为此智能体指定自定义系统提示文件。提示文件应包含特定于智能体用途的指令。

```json
{
  "agent": {
    "review": {
      "prompt": "{file:./prompts/code-review.txt}"
    }
  }
}
```

此路径是相对于配置文件所在位置的。因此，这适用于全局 OpenCode 配置和特定于项目的配置。

### 模型 (Model)

使用 `model` 配置覆盖此智能体的模型。用于使用针对不同任务优化的不同模型。例如，用于规划的更快模型，用于实现的更强模型。

<Callout type="tip">
如果你不指定模型，主智能体使用全局配置的模型，而子智能体将使用调用该子智能体的主智能体的模型。
</Callout>

```json
{
  "agent": {
    "plan": {
      "model": "anthropic/claude-haiku-4-20250514"
    }
  }
}
```

OpenCode 配置中的模型 ID 使用 `provider/model-id` 格式。例如，如果你使用的是 OpenCode Zen，你将使用 `opencode/gpt-5.1-codex` 作为 GPT 5.1 Codex。

### 工具 (Tools)

使用 `tools` 配置控制此智能体中可用的工具。你可以通过将特定工具设置为 `true` 或 `false` 来启用或禁用它们。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "tools": {
    "write": true,
    "bash": true
  },
  "agent": {
    "plan": {
      "tools": {
        "write": false,
        "bash": false
      }
    }
  }
}
```

<Callout type="note">
特定于智能体的配置覆盖全局配置。
</Callout>

你也可以使用通配符一次控制多个工具。例如，要禁用来自 MCP 服务器的所有工具：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "readonly": {
      "tools": {
        "mymcp_*": false,
        "write": false,
        "edit": false
      }
    }
  }
}
```

了解更多关于工具的信息。

### 权限 (Permissions)

你可以配置权限来管理智能体可以采取的操作。目前，`edit`、`bash` 和 `webfetch` 工具的权限可以配置为：

- "ask" — 运行工具前提示批准
- "allow" — 允许所有操作无需批准
- "deny" — 禁用工具

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "deny"
  }
}
```

你可以为每个智能体覆盖这些权限。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "edit": "deny"
  },
  "agent": {
    "build": {
      "permission": {
        "edit": "ask"
      }
    }
  }
}
```

你也可以在 Markdown 智能体中设置权限。

```yaml
---
description: Code review without edits
mode: subagent
permission:
  edit: deny
  bash:
    "*": ask
    "git diff": allow
    "git log*": allow
    "grep *": allow
  webfetch: deny
---

Only analyze code and suggest changes.
```

你可以为特定的 bash 命令设置权限。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "build": {
      "permission": {
        "bash": {
          "git push": "ask",
          "grep *": "allow"
        }
      }
    }
  }
}
```

这可以采用 glob 模式。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "build": {
      "permission": {
        "bash": {
          "git *": "ask"
        }
      }
    }
  }
}
```

你也可以使用 `*` 通配符来管理所有命令的权限。由于最后匹配的规则优先，请将 `*` 通配符放在第一位，特定规则放在后面。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "agent": {
    "build": {
      "permission": {
        "bash": {
          "*": "ask",
          "git status *": "allow"
        }
      }
    }
  }
}
```

了解更多关于权限的信息。

### 模式 (Mode)

使用 `mode` 配置控制智能体的模式。`mode` 选项用于确定如何使用智能体。

```json
{
  "agent": {
    "review": {
      "mode": "subagent"
    }
  }
}
```

`mode` 选项可以设置为 `primary`、`subagent` 或 `all`。如果未指定模式，默认为 `all`。

### 隐藏 (Hidden)

使用 `hidden: true` 从 `@` 自动完成菜单中隐藏子智能体。对于仅应由其他智能体通过 Task 工具以编程方式调用的内部子智能体很有用。

```json
{
  "agent": {
    "internal-helper": {
      "mode": "subagent",
      "hidden": true
    }
  }
}
```

这仅影响自动完成菜单中的用户可见性。如果权限允许，隐藏的智能体仍然可以通过 Task 工具由模型调用。

<Callout type="note">
仅适用于 `mode: subagent` 智能体。
</Callout>

### 任务权限 (Task permissions)

使用 `permission.task` 控制智能体可以通过 Task 工具调用哪些子智能体。使用 glob 模式进行灵活匹配。

```json
{
  "agent": {
    "orchestrator": {
      "mode": "primary",
      "permission": {
        "task": {
          "*": "deny",
          "orchestrator-*": "allow",
          "code-reviewer": "ask"
        }
      }
    }
  }
}
```

当设置为 `deny` 时，子智能体将从 Task 工具描述中完全移除，因此模型不会尝试调用它。

<Callout type="tip">
规则按顺序评估，最后匹配的规则获胜。在上面的例子中，`orchestrator-planner` 匹配 `*` (deny) 和 `orchestrator-*` (allow)，但由于 `orchestrator-*` 在 `*` 之后，结果是 `allow`。
</Callout>

<Callout type="tip">
用户总是可以通过 `@` 自动完成菜单直接调用任何子智能体，即使智能体的任务权限会拒绝它。
</Callout>

### 颜色 (Color)

使用 `color` 选项自定义智能体在 UI 中的视觉外观。这会影响智能体在界面中的显示方式。

使用有效的十六进制颜色 (例如, `#FF5733`) 或主题颜色：`primary`, `secondary`, `accent`, `success`, `warning`, `error`, `info`。

```json
{
  "agent": {
    "creative": {
      "color": "#ff6b6b"
    },
    "code-reviewer": {
      "color": "accent"
    }
  }
}
```

### Top P

使用 `top_p` 选项控制响应多样性。替代温度来控制随机性。

```json
{
  "agent": {
    "brainstorm": {
      "top_p": 0.9
    }
  }
}
```

值范围从 0.0 到 1.0。较低的值更专注，较高的值更多样化。

### 其他 (Additional)

你在智能体配置中指定的任何其他选项都将直接传递给提供商作为模型选项。这允许你使用特定于提供商的功能和参数。

例如，对于 OpenAI 的推理模型，你可以控制推理工作量：

```json
{
  "agent": {
    "deep-thinker": {
      "description": "Agent that uses high reasoning effort for complex problems",
      "model": "openai/gpt-5",
      "reasoningEffort": "high",
      "textVerbosity": "low"
    }
  }
}
```

这些附加选项是特定于模型和提供商的。查看你的提供商文档以获取可用参数。

<Callout type="tip">
运行 `opencode models` 查看可用模型列表。
</Callout>

## 创建智能体 (Create agents)

你可以使用以下命令创建新智能体：

```bash
opencode agent create
```

此交互式命令将：

- 询问将智能体保存在哪里；全局或特定于项目。
- 描述智能体应该做什么。
- 生成适当的系统提示和标识符。
- 让你选择智能体可以访问哪些工具。
- 最后，创建一个包含智能体配置的 markdown 文件。

## 用例 (Use cases)

以下是不同智能体的一些常见用例。

- Build agent: 启用所有工具的完整开发工作
- Plan agent: 分析和规划而不进行更改
- Review agent: 具有只读访问权限加上文档工具的代码审查
- Debug agent: 专注于调查，启用 bash 和读取工具
- Docs agent: 编写文档，具有文件操作但没有系统命令

## 示例 (Examples)

以下是你可能会觉得有用的一些示例智能体。

<Callout type="tip">
你有想要分享的智能体吗？提交一个 PR。
</Callout>

### 文档智能体 (Documentation agent)

```yaml
---
description: Writes and maintains project documentation
mode: subagent
tools:
  bash: false
---

You are a technical writer. Create clear, comprehensive documentation.

Focus on:

- Clear explanations
- Proper structure
- Code examples
- User-friendly language
```

### 安全审计员 (Security auditor)

```yaml
---
description: Performs security audits and identifies vulnerabilities
mode: subagent
tools:
  write: false
  edit: false
---

You are a security expert. Focus on identifying potential security issues.

Look for:

- Input validation vulnerabilities
- Authentication and authorization flaws
- Data exposure risks
- Dependency vulnerabilities
- Configuration security issues
```

<AdPlaceholder />
