---
title: 权限
tool: "opencode"
slug: permissions
description: 控制哪些操作需要批准才能运行 - OpenCode 使用权限配置来决定给定操作应该自动运行、提示你或被阻止。
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

<AdPlaceholder />

OpenCode 使用权限配置来决定给定操作是否应该自动运行、提示你或被阻止。

从 v1.1.1 开始，传统的工具布尔配置已被弃用并合并到权限中。旧的工具配置仍然支持以实现向后兼容。

## 操作

每个权限规则解析为以下之一：

- `"allow"` — 无需批准即可运行
- `"ask"` — 提示批准
- `"deny"` — 阻止操作

## 配置

你可以设置全局权限（使用 *），并覆盖特定工具。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "*": "ask",
    "bash": "allow",
    "edit": "deny"
  }
}
```

你也可以一次性设置所有权限：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": "allow"
}
```

## 粒细规则（对象语法）

对于大多数权限，你可以使用对象来根据工具输入应用不同的操作。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "bash": {
      "*": "ask",
      "git *": "allow",
      "npm *": "allow",
      "rm *": "deny",
      "grep *": "allow"
    },
    "edit": {
      "*": "deny",
      "packages/web/src/content/docs/*.mdx": "allow"
    }
  }
}
```

规则按模式匹配进行评估，最后一个匹配的规则获胜。一个常见的模式是先放置通配符 `*` 规则，然后在后面放置更具体的规则。

## 通配符

权限模式使用简单的通配符匹配：

- `*` - 匹配零个或更多任意字符
- `?` - 恰好匹配一个字符
- 所有其他字符按字面量匹配

## 主目录扩展

你可以使用 external_directory 来允许在 OpenCode 启动时触及项目工作目录之外的路径的工具调用。这适用于任何将路径作为输入的工具（例如 read、edit、list、glob、grep 和许多 bash 命令）。

<Callout type="note">
主目录扩展（like ~/...）仅影响模式的写入方式。它不会使外部路径成为当前工作空间的一部分，因此路径在项目工作目录之外仍必须通过 external_directory 允许。
</Callout>

例如，这允许访问 ~/projects/personal/** 下的所有内容：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "external_directory": {
      "~/projects/personal/**": "allow"
    }
  }
}
```

任何在此处允许的目录都继承与当前工作空间相同的默认值。由于 read 默认为 allow，因此允许中的条目（除非被覆盖）也将被允许。添加显式规则以限制这些路径中的其他工具（例如，在允许读取的同时禁用编辑）。

## 可用权限

OpenCode 权限按工具名称加上几个安全防护进行键控：

- read — 读取文件（匹配文件路径）
- edit — 所有文件修改（涵盖 edit、write、patch、multiedit）
- glob — 文件 globbing（匹配 glob 模式）
- grep — 内容搜索（匹配正则模式）
- list — 列出目录中的文件（匹配目录路径）
- bash — 运行 shell 命令（匹配解析后的命令，如 git status --porcelain）
- task — 启动子代理（匹配子代理类型）
- skill — 加载技能（匹配技能名称）
- lsp — 运行 LSP 查询（当前非正则）
- todoread、todowrite — 读取/更新待办事项列表
- webfetch — 获取 URL（匹配 URL）
- websearch、codesearch — 网络搜索/代码搜索（匹配查询）
- question — 在执行期间向用户提问
- external_directory — 触及项目工作目录之外的路径
- doom_loop — 当相同工具调用重复 3 次且输入相同时触发时
- filetime_check — 检查文件时间以进行优化（弃用）

## 默认值

如果你不指定任何内容，OpenCode 从宽限的默认值开始：

- 大多数权限默认为 `"allow"`。
- doom_loop 和 external_directory 默认为 `"ask"`。
- read 默认为 `"allow"`，但 .env 文件默认被拒绝：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "read": {
      "*": "allow",
      "*.env": "deny",
      "*.env.*": "deny",
      "*.env.example": "allow"
    }
  }
}
```

## "Ask" 的作用

当 OpenCode 提示批准时，UI 提供三种结果：

- once — 仅批准此请求
- always — 批准未来与建议模式匹配的请求（针对 OpenCode 会话的剩余部分）
- reject — 拒绝并禁用

为特定操作（如 bash 批准）提供的建议模式列表由该工具提供。例如，bash 批准通常会列入安全命令前缀，如 `git status*`。

## 代理

你可以为每个代理覆盖权限。代理权限与全局配置合并，且代理规则优先。

<Callout type="note">
请参阅精细规则（对象语法）部分以获取更详细的模式匹配示例。
</Callout>

```json
{
  "$schema": "https://opencode.ai/config.json",
  "permission": {
    "bash": {
      "*": "ask",
      "git *": "allow",
      "git commit *": "deny",
      "grep *": "allow"
    },
  },
  "agent": {
    "build": {
      "permission": {
        "bash": {
          "*": "ask",
          "git *": "allow",
          "grep *": "allow"
        }
      }
    }
  }
}
```

你也可以在 Markdown 中配置代理权限：

```yaml
---
description: 代码审查但不进行编辑
mode: subagent
permission:
  edit: deny
  bash: ask
  webfetch: deny
---
仅分析代码并建议更改。
```

<Callout type="tip">
对带参数的命令使用模式匹配。 "git status" 允许默认行为运行，但 "git commit *" 需要显式权限。
</Callout>

## 主目录扩展

使用 ~ 或 $HOME 在模式开头来引用你的主目录。这对于 external_directory 规则特别有用。

```bash
~/projects/* -> /Users/username/projects/*
$HOME/projects/* -> /Users/username/projects/*
~ -> /Users/username
```

<AdPlaceholder />
