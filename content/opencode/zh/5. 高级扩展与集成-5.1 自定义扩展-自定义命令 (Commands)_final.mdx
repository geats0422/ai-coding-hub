---
title: 自定义命令
tool: "opencode"
slug: commands
description: 为重复性任务创建自定义命令 - 自定义命令允许你指定在 TUI 中执行该命令时要运行的提示。
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

<AdPlaceholder />

自定义命令允许你指定在 TUI 中执行该命令时要运行的提示。

```bash
/my-command
```

自定义命令是除了内置命令 (如 `/init`, `/undo`, `/redo`, `/share`, `/help`) 之外的命令。了解更多。

## 创建命令文件 (Create command files)

在 `commands/` 目录中创建 markdown 文件以定义自定义命令。

创建 `.opencode/commands/test.md`:

```yaml
---
description: Run tests with coverage
agent: build
model: anthropic/claude-3-5-sonnet-20241022
---

Run the full test suite with coverage report and show any failures.
Focus on the failing tests and suggest fixes.
```

Frontmatter 定义命令属性。内容成为模板。

通过键入 `/` 后跟命令名称来使用该命令。

```bash
"/test"
```

## 配置 (Configure)

你可以通过 OpenCode 配置或在 `commands/` 目录中创建 markdown 文件来添加自定义命令。

### JSON

在你的 OpenCode 配置中使用 `command` 选项：

```jsonc
{
  "$schema": "https://opencode.ai/config.json",
  "command": {
    // This becomes the name of the command
    "test": {
      // This is the prompt that will be sent to the LLM
      "template": "Run the full test suite with coverage report and show any failures.\nFocus on the failing tests and suggest fixes.",
      // This is shown as the description in the TUI
      "description": "Run tests with coverage",
      "agent": "build",
      "model": "anthropic/claude-3-5-sonnet-20241022"
    }
  }
}
```

现在你可以在 TUI 中运行此命令：

```bash
/test
```

### Markdown

你也可以使用 markdown 文件定义命令。将它们放在：

- 全局: `~/.config/opencode/commands/`
- 每个项目: `.opencode/commands/`

```yaml
---
description: Run tests with coverage
agent: build
model: anthropic/claude-3-5-sonnet-20241022
---

Run the full test suite with coverage report and show any failures.
Focus on the failing tests and suggest fixes.
```

markdown 文件名成为命令名称。例如，`test.md` 让你运行：

```bash
/test
```

## 提示配置 (Prompt config)

自定义命令的提示支持几种特殊的占位符和语法。

### 参数 (Arguments)

使用 `$ARGUMENTS` 占位符将参数传递给命令。

```yaml
---
description: Create a new component
---

Create a new React component named $ARGUMENTS with TypeScript support.
Include proper typing and basic structure.
```

带参数运行命令：

```bash
/component Button
```

`$ARGUMENTS` 将被替换为 `Button`。

你也可以使用位置参数访问单个参数：

- `$1` - 第一个参数
- `$2` - 第二个参数
- `$3` - 第三个参数
- 依此类推...

例如：

```yaml
---
description: Create a new file with content
---

Create a file named $1 in the directory $2
with the following content: $3
```

运行命令：

```bash
/create-file config.json src "{ \"key\": \"value\" }"
```

这将替换：

- `$1` 为 `config.json`
- `$2` 为 `src`
- `$3` 为 `{ "key": "value" }`

### Shell 输出 (Shell output)

使用 `!command` 将 bash 命令输出注入到你的提示中。

例如，要创建一个分析测试覆盖率的自定义命令：

```yaml
---
description: Analyze test coverage
---

Here are the current test results:
!`npm test`

Based on these results, suggest improvements to increase coverage.
```

或者审查最近的更改：

```yaml
---
description: Review recent changes
---

Recent git commits:
!`git log --oneline -10`

Review these changes and suggest any improvements.
```

命令在你的项目根目录中运行，其输出成为提示的一部分。

### 文件引用 (File references)

使用 `@` 后跟文件名在你的命令中包含文件。

```yaml
---
description: Review component
---

Review the component in @src/components/Button.tsx.
Check for performance issues and suggest improvements.
```

文件内容会自动包含在提示中。

## 选项 (Options)

让我们详细看看配置选项。

### 模板 (Template)

`template` 选项定义执行命令时将发送给 LLM 的提示。

```json
{
  "command": {
    "test": {
      "template": "Run the full test suite with coverage report and show any failures.\nFocus on the failing tests and suggest fixes."
    }
  }
}
```

这是一个必需的配置选项。

### 描述 (Description)

使用 `description` 选项提供命令功能的简要描述。

```json
{
  "command": {
    "test": {
      "description": "Run tests with coverage"
    }
  }
}
```

当你输入命令时，这将在 TUI 中显示为描述。

### 智能体 (Agent)

使用 `agent` 配置可选地指定应执行此命令的智能体。如果这是一个子智能体，默认情况下该命令将触发子智能体调用。要禁用此行为，请将 `subtask` 设置为 `false`。

```json
{
  "command": {
    "review": {
      "agent": "plan"
    }
  }
}
```

这是一个可选的配置选项。如果未指定，默认为你当前的智能体。

### 子任务 (Subtask)

使用 `subtask` 布尔值强制命令触发子智能体调用。如果你希望命令不污染你的主要上下文，这将非常有用，并且即使智能体配置上的模式设置为 `primary`，也会强制智能体作为子智能体行动。

```json
{
  "command": {
    "analyze": {
      "subtask": true
    }
  }
}
```

这是一个可选的配置选项。

### 模型 (Model)

使用 `model` 配置覆盖此命令的默认模型。

```json
{
  "command": {
    "analyze": {
      "model": "anthropic/claude-3-5-sonnet-20241022"
    }
  }
}
```

这是一个可选的配置选项。

## 内置 (Built-in)

opencode 包含几个内置命令，如 `/init`, `/undo`, `/redo`, `/share`, `/help`；了解更多。

<Callout type="note">
自定义命令可以覆盖内置命令。
</Callout>

如果你定义了一个同名的自定义命令，它将覆盖内置命令。

<AdPlaceholder />
