---
title: LSP 服务器
tool: "opencode"
slug: lsp-servers
description: OpenCode 与你的 LSP 服务器集成 - OpenCode 与你的语言服务器协议 (LSP) 集成，以帮助 LLM 与你的代码库交互。
---

import { AdPlaceholder } from '@/components/AdPlaceholder'
import { Callout } from '@/components/Callout'

<AdPlaceholder />

OpenCode 与你的语言服务器协议 (LSP) 集成，以帮助 LLM 与你的代码库交互。它使用诊断信息向 LLM 提供反馈。

## 内置 (Built-in)

OpenCode 为流行语言配备了几个内置的 LSP 服务器：

| LSP 服务器 | 扩展名 | 要求 |
|------------|------------|--------------|
| astro | .astro | 为 Astro 项目自动安装 |
| bash | .sh, .bash, .zsh, .ksh | 自动安装 bash-language-server |
| clangd | .c, .cpp, .cc, .cxx, .c++, .h, .hpp, .hh, .hxx, .h++ | 为 C/C++ 项目自动安装 |
| csharp | .cs | 已安装 .NET SDK |
| clojure-lsp | .clj, .cljs, .cljc, .edn | clojure-lsp 命令可用 |
| dart | .dart | dart 命令可用 |
| deno | .ts, .tsx, .js, .jsx, .mjs | deno 命令可用 (自动检测 deno.json/deno.jsonc) |
| elixir-ls | .ex, .exs | elixir 命令可用 |
| eslint | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue | 项目中的 eslint 依赖 |
| fsharp | .fs, .fsi, .fsx, .fsscript | 已安装 .NET SDK |
| gleam | .gleam | gleam 命令可用 |
| gopls | .go | go 命令可用 |
| hls | .hs, .lhs | haskell-language-server-wrapper 命令可用 |
| jdtls | .java | 已安装 Java SDK (版本 21+) |
| kotlin-ls | .kt, .kts | 为 Kotlin 项目自动安装 |
| lua-ls | .lua | 为 Lua 项目自动安装 |
| nixd | .nix | nixd 命令可用 |
| ocaml-lsp | .ml, .mli | ocamllsp 命令可用 |
| oxlint | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts, .vue, .astro, .svelte | 项目中的 oxlint 依赖 |
| php intelephense | .php | 为 PHP 项目自动安装 |
| prisma | .prisma | prisma 命令可用 |
| pyright | .py, .pyi | 已安装 pyright 依赖 |
| ruby-lsp (rubocop) | .rb, .rake, .gemspec, .ru | ruby 和 gem 命令可用 |
| rust | .rs | rust-analyzer 命令可用 |
| sourcekit-lsp | .swift, .objc, .objcpp | 已安装 swift (macOS 上为 xcode) |
| svelte | .svelte | 为 Svelte 项目自动安装 |
| terraform | .tf, .tfvars | 从 GitHub 发布自动安装 |
| tinymist | .typ, .typc | 从 GitHub 发布自动安装 |
| typescript | .ts, .tsx, .js, .jsx, .mjs, .cjs, .mts, .cts | 项目中的 typescript 依赖 |
| vue | .vue | 为 Vue 项目自动安装 |
| yaml-ls | .yaml, .yml | 自动安装 Red Hat yaml-language-server |
| zls | .zig, .zon | zig 命令可用 |

当检测到上述文件扩展名之一且满足要求时，LSP 服务器会自动启用。

<Callout type="note">
你可以通过将 `OPENCODE_DISABLE_LSP_DOWNLOAD` 环境变量设置为 `true` 来禁用自动 LSP 服务器下载。
</Callout>

## 工作原理 (How It Works)

当 opencode 打开文件时，它会：

1. 检查文件扩展名是否匹配所有启用的 LSP 服务器。
2. 如果尚未运行，则启动适当的 LSP 服务器。

## 配置 (Configure)

你可以通过 OpenCode 配置中的 `lsp` 部分来自定义 LSP 服务器。

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {}
}
```

每个 LSP 服务器支持以下内容：

| 属性 | 类型 | 描述 |
|----------|------|-------------|
| disabled | boolean | 设置为 true 以禁用 LSP 服务器 |
| command | string[] | 启动 LSP 服务器的命令 |
| extensions | string[] | 此 LSP 服务器应处理的文件扩展名 |
| env | object | 启动服务器时设置的环境变量 |
| initialization | object | 发送到 LSP 服务器的初始化选项 |

让我们看一些例子。

### 环境变量 (Environment variables)

使用 `env` 属性在启动 LSP 服务器时设置环境变量：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "rust": {
      "env": {
        "RUST_LOG": "debug"
      }
    }
  }
}
```

### 初始化选项 (Initialization options)

使用 `initialization` 属性将初始化选项传递给 LSP 服务器。这些是在 LSP 初始化请求期间发送的特定于服务器的设置：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "initialization": {
        "preferences": {
          "importModuleSpecifierPreference": "relative"
        }
      }
    }
  }
}
```

<Callout type="note">
初始化选项因 LSP 服务器而异。查看你的 LSP 服务器文档以获取可用选项。
</Callout>

## 禁用 LSP 服务器 (Disabling LSP servers)

要全局禁用所有 LSP 服务器，请将 `lsp` 设置为 `false`：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": false
}
```

要禁用特定的 LSP 服务器，请将 `disabled` 设置为 `true`：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "typescript": {
      "disabled": true
    }
  }
}
```

## 自定义 LSP 服务器 (Custom LSP servers)

你可以通过指定命令和文件扩展名来添加自定义 LSP 服务器：

```json
{
  "$schema": "https://opencode.ai/config.json",
  "lsp": {
    "custom-lsp": {
      "command": ["custom-lsp-server", "--stdio"],
      "extensions": [".custom"]
    }
  }
}
```

## 附加信息 (Additional Information)

### PHP Intelephense

PHP Intelephense 通过许可证密钥提供高级功能。你可以通过将 (仅) 密钥放在文本文件中来提供许可证密钥：

- 在 macOS/Linux 上: `$HOME/intelephense/license.txt`
- 在 Windows 上: `%USERPROFILE%/intelephense/license.txt`

该文件应仅包含许可证密钥，没有其他内容。

<AdPlaceholder />
